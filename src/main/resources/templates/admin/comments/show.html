<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý bình luận - EduShare Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}"> 
    <link rel="stylesheet" th:href="@{/css/admin/comments.css}">
</head>

<body class="admin-body">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="admin-logo">
                <a href="index.html" class="logo">
                    <div class="logo-icon">E</div>
                    <div class="logo-text">EduShare</div>
                </a>
            </div>

            <div class="admin-header-actions">
                <div class="admin-search">
                    <input type="text" placeholder="Tìm kiếm...">
                    <button><i class="fas fa-search"></i></button>
                </div>

                <div class="dark-mode-toggle" id="darkModeToggle"></div>

                <div class="admin-notifications">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">5</span>
                    </button>
                </div>

                <div class="admin-profile">
                    <div class="admin-avatar">
                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                            alt="Admin">
                    </div>
                    <div class="admin-info">
                        <span class="admin-name">Nguyễn Văn A</span>
                        <span class="admin-role">Quản trị viên</span>
                    </div>
                    <div class="admin-dropdown">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Container -->
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <nav class="admin-nav">
                <ul class="admin-menu">
                    <li class="admin-menu-item">
                        <a href="index.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Bảng điều khiển</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="users.html">
                            <i class="fas fa-users"></i>
                            <span>Quản lý người dùng</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="documents.html">
                            <i class="fas fa-file-alt"></i>
                            <span>Quản lý tài liệu</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="categories.html">
                            <i class="fas fa-folder"></i>
                            <span>Quản lý danh mục</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="tags.html">
                            <i class="fas fa-tags"></i>
                            <span>Quản lý tags</span>
                        </a>
                    </li>
                    <li class="admin-menu-item active">
                        <a href="comments.html">
                            <i class="fas fa-comments"></i>
                            <span>Quản lý bình luận</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="reports.html">
                            <i class="fas fa-flag"></i>
                            <span>Báo cáo vi phạm</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="ip-bans.html">
                            <i class="fas fa-ban"></i>
                            <span>IP bị cấm</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="statistics.html">
                            <i class="fas fa-chart-bar"></i>
                            <span>Thống kê</span>
                        </a>
                    </li>
                    <!-- Revenue Management Dropdown -->
                    <li class="admin-menu-item has-submenu">
                        <a href="javascript:void(0)">
                            <i class="fas fa-coins"></i>
                            <span>Quản lý doanh thu</span>
                            <i class="fas fa-chevron-down submenu-icon"></i>
                        </a>
                        <ul class="submenu">
                            <li class="submenu-item">
                                <a href="coin-packages.html">
                                    <i class="fas fa-box"></i>
                                    <span>Gói xu</span>
                                </a>
                            </li>
                            <li class="submenu-item">
                                <a href="transactions.html">
                                    <i class="fas fa-exchange-alt"></i>
                                    <span>Giao dịch</span>
                                </a>
                            </li>
                            <li class="submenu-item">
                                <a href="withdrawals.html">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>Yêu cầu rút tiền</span>
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="admin-menu-item">
                        <a href="settings.html">
                            <i class="fas fa-cog"></i>
                            <span>Cài đặt</span>
                        </a>
                    </li>
                    <li class="admin-menu-item">
                        <a href="../index.html">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Đăng xuất</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-content">
            <div class="admin-content-header">
                <h1 class="admin-page-title">Quản lý bình luận</h1>
                <div class="admin-breadcrumbs">
                    <a href="index.html">Admin</a>
                    <span>/</span>
                    <span>Quản lý bình luận</span>
                </div>
            </div>

            <!-- Comments Stats Cards -->
            <div class="comments-stats">
			  <div class="stat-card">
			    <div class="stat-icon"><i class="fas fa-comments"></i></div>
			    <div class="stat-content">
			      <div class="stat-value" th:text="${totalComments}">0</div>
			      <div class="stat-label">Tổng số bình luận</div>
			    </div>
			  </div>
			  <div class="stat-card">
			    <div class="stat-icon new-icon"><i class="fas fa-comment-dots"></i></div>
			    <div class="stat-content">
			      <div class="stat-value" th:text="${newComments}">0</div>
			      <div class="stat-label">Bình luận mới trong tuần</div>
			    </div>
			  </div>
			  <div class="stat-card">
			    <div class="stat-icon reported-icon"><i class="fas fa-flag"></i></div>
			    <div class="stat-content">
			      <div class="stat-value" th:text="${reportedCount}">0</div>
			      <div class="stat-label">Bình luận bị báo cáo</div>
			    </div>
			  </div>
			  <div class="stat-card">
			    <div class="stat-icon hidden-icon"><i class="fas fa-eye-slash"></i></div>
			    <div class="stat-content">
			      <div class="stat-value" th:text="${hiddenCount}">0</div>
			      <div class="stat-label">Bình luận bị ẩn</div>
			    </div>
			  </div>
			</div>


            <!-- Comments Management Tools -->
            <div class="management-tools">
                <form method="get" class="search-filters">
				  <input type="hidden" name="tab" th:value="${activeTab}" />
				
				  <div class="tool-item">
				    <input type="text"
				           name="keyword"
				           placeholder="Tìm kiếm bình luận..."
				           class="search-input"
				           th:value="${keyword}"
				           onkeydown="if(event.key==='Enter') this.form.submit()" />
				  </div>
				
				  <div class="tool-item">
				    <select name="statusFilter"
				            class="filter-select"
				            th:onchange="this.form.submit()">
				      <option value="all"    th:selected="${statusFilter == 'all'}">Tất cả trạng thái</option>
				      <option value="visible"th:selected="${statusFilter == 'visible'}">Hiển thị</option>
				      <option value="hidden" th:selected="${statusFilter == 'hidden'}">Đã ẩn</option>
				      <option value="reported" th:selected="${statusFilter == 'reported'}">Bị báo cáo</option>
				    </select>
				  </div>
				</form>

                <!-- <div class="action-buttons">
                    <button class="export-btn">
                        <i class="fas fa-download"></i> Xuất dữ liệu
                    </button>
                </div> -->
            </div>

            <!-- Comments Tabs -->
           <div class="comments-tabs">
			  <a th:href="@{/admin/comments(page=0,tab='all')}"
			     class="tab-button"
			     th:classappend="${activeTab == 'all'} ? ' active' : ''">
			    Tất cả (<span th:text="${totalComments}">0</span>)
			  </a>
			  <a th:href="@{/admin/comments(page=0,tab='recent')}"
			     class="tab-button"
			     th:classappend="${activeTab == 'recent'} ? ' active' : ''">
			    Gần đây (<span th:text="${newComments}">0</span>)
			  </a>
			  <a th:href="@{/admin/comments(page=0,tab='reported')}"
			     class="tab-button"
			     th:classappend="${activeTab == 'reported'} ? ' active' : ''">
			    Bị báo cáo (<span th:text="${reportedCount}">0</span>)
			  </a>
			  <a th:href="@{/admin/comments(page=0,tab='hidden')}"
			     class="tab-button"
			     th:classappend="${activeTab == 'hidden'} ? ' active' : ''">
			    Đã ẩn (<span th:text="${hiddenCount}">0</span>)
			  </a>
			</div>


            <!-- Comments List -->
			<div class="comments-list">
			  <div th:each="comment : ${commentsPage.content}">
			    <!-- Comment Container with dynamic class -->
			    <div class="comment-item"
			         th:classappend="${comment.reported} ? ' reported' : (comment.status != 'active' ? '' : '')">
			      <!-- Header -->
			      <div class="comment-header">
			        <div class="commenter-info">
			          
			          <div class="commenter-details">
				        <img th:src="@{/image/{f}(f=${comment.userAvatar})}" alt="User Avatar">
			            <div class="commenter-name" th:text="${comment.userFullName}">Tên người dùng</div>
			            <div class="comment-meta">
			              <span class="comment-time"
			                    th:text="${#temporals.format(comment.createdAt, 'dd/MM/yyyy - HH:mm')}">
			                Ngày giờ
			              </span>
			              <span class="document-title">
			                Trên: <a th:href="@{/documents/{id}(id=${comment.documentId})}"
			                         th:text="${comment.documentTitle}">Tiêu đề tài liệu</a>
			              </span>
			            </div>
			          </div>
			        </div>
			        <div class="comment-status"
					     th:classappend="${comment.reported?' reported':(comment.status!='active'?' hidden':' visible')}">
					  <i th:class="${comment.reported?'fas fa-flag':(comment.status!='active'?'fas fa-eye-slash':'fas fa-eye')}"></i>
					  <span th:text="${comment.reported?'Bị báo cáo':(comment.status!='active'?'Đã ẩn':'Hiển thị')}"></span>
					</div>
			      </div>
			
			      <!-- Content -->
			      <div class="comment-content">
			        <p th:text="${comment.content}">Nội dung bình luận</p>
			      </div>
			
			      <!-- Report Info -->
			      <div class="report-info" th:if="${comment.reported}">
			        <div class="report-header">
			          <i class="fas fa-exclamation-triangle"></i> Bình luận này đã bị báo cáo
			        </div>
			        <div class="report-details">
			          <div class="reporter">
			            <span>Người báo cáo:</span> <span th:text="${comment.reporterName}">Người báo cáo</span>
			          </div>
			          <div class="report-reason">
			            <span>Lý do:</span> <span th:text="${comment.reportReason}">Lý do báo cáo</span>
			          </div>
			          <div class="report-time">
			            <span>Thời gian:</span>
			            <span th:text="${#temporals.format(comment.reportTime, 'dd/MM/yyyy - HH:mm')}">Thời gian báo cáo</span>
			          </div>
			        </div>
			      </div>
			
			      <!-- Actions -->
			      <div class="comment-actions">
			        <!-- If reported, show report actions -->
			       <div class="report-actions" th:if="${comment.reported}">
					  <a th:href="@{/admin/comments/{id}/report/approve(id=${comment.id})}"
					     class="report-approve"
					     title="Chấp nhận báo cáo"
					     data-confirm="Bạn có chắc chắn muốn chấp nhận báo cáo và ẩn bình luận này không?">
					    Chấp nhận báo cáo
					  </a>
					  <a th:href="@{/admin/comments/{id}/report/reject(id=${comment.id})}"
					     class="report-reject"
					     title="Từ chối báo cáo"
					     data-confirm="Bạn có chắc chắn muốn từ chối báo cáo và hiện lại bình luận này không?">
					    Từ chối báo cáo
					  </a>
					</div>

			
			        <!-- Comment buttons -->
			       <div class="comment-buttons">
					  <a th:if="${comment.status == 'active'}"
					     th:href="@{/admin/comments/{id}/hide(id=${comment.id})}"
					     class="action-btn"
					     title="Ẩn bình luận"
					     data-confirm="Bạn có chắc chắn muốn ẩn bình luận này?">
					    <i class="fas fa-eye-slash"></i>
					  </a>
					  <a th:if="${comment.status != 'active'}"
					     th:href="@{/admin/comments/{id}/show(id=${comment.id})}"
					     class="action-btn show-btn"
					     title="Hiển thị bình luận"
					     data-confirm="Bạn có chắc chắn muốn hiển thị bình luận này?">
					    <i class="fas fa-eye"></i>
					  </a>
					
					  <!-- Delete -->
					  <a th:href="@{/admin/comments/{id}/delete(id=${comment.id})}"
					     class="action-btn"
					     title="Xóa bình luận"
					     data-confirm="Bạn có chắc chắn muốn xóa bình luận này?">
					    <i class="fas fa-trash"></i>
					  </a>
					</div>


			      </div>
			    </div>
			  </div>
            </div>
            <!-- Pagination -->
			<div class="pagination">
			  <button class="pagination-btn prev-btn"
			          th:disabled="${commentsPage.first}"
			          th:attr="data-page=${currentPage - 1}">
			    <i class="fas fa-chevron-left"></i>
			  </button>
			
			  <div class="pagination-pages">
			    <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
			      <button class="pagination-btn page-btn"
			              th:classappend="${i} == ${currentPage} ? ' active' : ''"
			              th:text="${i + 1}"
			              th:attr="data-page=${i}">
			      </button>
			    </span>
			  </div>
			
			  <button class="pagination-btn next-btn"
			          th:disabled="${commentsPage.last}"
			          th:attr="data-page=${currentPage + 1}">
			    <i class="fas fa-chevron-right"></i>
			  </button>
			</div>
        </main>
    </div>
    
    <script>
	  document.addEventListener("DOMContentLoaded", function () {
	    document.querySelectorAll(".pagination-btn[data-page]").forEach(function (btn) {
	      btn.addEventListener("click", function () {
	        const page = this.getAttribute("data-page");
	        if (page !== null) {
	          const url = new URL(window.location.href);
	          url.searchParams.set("page", page);
	          window.location.href = url.toString();
	        }
	      });
	    });
	    document.querySelectorAll('a[data-confirm]').forEach(el => {
	        el.addEventListener('click', e => {
	          const msg = el.getAttribute('data-confirm');
	          if (!confirm(msg)) {
	            e.preventDefault();
	          }
	        });
	      });
	  });
	</script>
	    
</body>

</html>