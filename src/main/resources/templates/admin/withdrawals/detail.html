<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi tiết withdrawal - Admin</title>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />

    <!-- CSS Files -->
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/toast.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/withdrawals.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/withdrawals-detail.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/withdrawals-delete.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/notifications.css}" />
    <script th:src="@{/js/admin/notifications.js}"></script>
  </head>

  <body class="admin-body">
    <!-- Admin Header -->
    <div th:replace="~{fragments/admin/layout :: header}"></div>

    <!-- Admin Container -->
    <div class="admin-container">
      <!-- Sidebar -->
      <div th:replace="~{fragments/admin/sidebar :: admin-sidebar}"></div>

      <!-- Main Content -->
      <main class="admin-content">
        <div class="admin-content-header">
          <h1 class="admin-page-title">
            Chi tiết withdrawal
            <!-- <span class="withdrawal-code" th:text="${withdrawal.code}"></span> -->
          </h1>
          <div class="admin-breadcrumbs">
            <a th:href="@{/admin}">Admin</a>
            <span>/</span>
            <a th:href="@{/admin/withdrawals}">Quản lý doanh thu</a>
            <span>/</span>
            <a th:href="@{/admin/withdrawals}">Withdrawals</a>
            <span>/</span>
            <span>Chi tiết</span>
          </div>
        </div>

        <!-- Success/Error Messages -->
        <div th:if="${successMessage}" class="alert alert-success">
          <i class="fas fa-check-circle"></i>
          <span th:text="${successMessage}"></span>
        </div>

        <div th:if="${errorMessage}" class="alert alert-error">
          <i class="fas fa-exclamation-circle"></i>
          <span th:text="${errorMessage}"></span>
        </div>

        <div th:if="${warningMessage}" class="alert alert-warning">
          <i class="fas fa-exclamation-triangle"></i>
          <span th:text="${warningMessage}"></span>
        </div>

        <!-- Detail Container -->
        <div class="detail-container">
          <!-- Main Information Card -->
          <div class="detail-card main-info">
            <div class="card-header">
              <h2 style="color: #fff">
                <i class="fas fa-money-bill-wave"></i>
                Thông tin withdrawal
              </h2>
            </div>

            <div class="card-content">
              <!-- Risk & Flags -->
              <div
                class="risk-flags"
                style="display: flex; gap: 10px; margin-bottom: 12px"
              >
                <span
                  th:if="${risk != null}"
                  th:text="${'Risk score: ' + risk['score'] + ' (' + risk['level'] + ')'}"
                  th:classappend="${risk['level'] == 'high' ? 'badge badge-danger' : (risk['level'] == 'medium' ? 'badge badge-warning' : 'badge badge-success')}"
                  class="badge"
                >
                  Risk score: 0 (low)
                </span>
                <span
                  th:if="${risk != null and risk['highAmount']}"
                  class="badge badge-warning"
                >
                  Cần xem xét đặc biệt (số xu > 1000)
                </span>
                <span
                  th:if="${risk != null and risk['isNewUser']}"
                  class="badge badge-info"
                >
                  User mới - Cần xác minh
                </span>
              </div>

              <div class="info-grid">
                <!-- Basic Information -->
                <div class="info-section">
                  <h3>Thông tin cơ bản</h3>
                  <div class="info-row">
                    <label>Mã withdrawal:</label>
                    <span
                      class="value code-value"
                      th:text="${withdrawal.code}"
                    ></span>
                  </div>
                  <div class="info-row">
                    <label>Số xu:</label>
                    <span
                      class="value amount-value"
                      th:text="${#numbers.formatDecimal(withdrawal.amount, 0, 'COMMA', 0, 'POINT')} + ' xu'"
                    ></span>
                  </div>
                  <div class="info-row">
                    <label>Quy đổi VND:</label>
                    <span
                      class="value amount-value"
                      th:text="${#numbers.formatDecimal(withdrawal.amount * 1000, 0, 'COMMA', 0, 'POINT')} + ' VND'"
                    ></span>
                  </div>
                  <div class="info-row">
                    <label>Trạng thái:</label>
                    <span
                      class="value status-value"
                      th:classappend="${'status-' + withdrawal.status.value}"
                    >
                      <i class="fas fa-circle"></i>
                      <span th:text="${withdrawal.status.displayName}"></span>
                    </span>
                  </div>
                  <div class="info-row">
                    <label>Phương thức thanh toán:</label>
                    <span
                      class="value"
                      th:text="${withdrawal.paymentMethod}"
                    ></span>
                  </div>
                </div>

                <!-- User Information -->
                <div class="info-section">
                  <h3>Thông tin người dùng</h3>
                  <div class="info-row">
                    <label>Tên đầy đủ:</label>
                    <span
                      class="value"
                      th:text="${withdrawal.user.fullName}"
                    ></span>
                  </div>
                  <div class="info-row">
                    <label>Username:</label>
                    <span
                      class="value"
                      th:text="${withdrawal.user.username}"
                    ></span>
                  </div>
                  <div class="info-row">
                    <label>Email:</label>
                    <span
                      class="value"
                      th:text="${withdrawal.user.email}"
                    ></span>
                  </div>
                  <div class="info-row" th:if="${withdrawal.user.phoneNumber}">
                    <label>Số điện thoại:</label>
                    <span
                      class="value"
                      th:text="${withdrawal.user.phoneNumber}"
                    ></span>
                  </div>
                </div>

                <!-- Time Information -->
                <div class="info-section">
                  <h3>Thông tin thời gian</h3>
                  <div class="info-row">
                    <label>Ngày tạo:</label>
                    <span
                      class="value"
                      th:text="${#temporals.format(withdrawal.createdAt, 'dd/MM/yyyy HH:mm:ss')}"
                    ></span>
                  </div>
                  <div class="info-row" th:if="${withdrawal.updatedAt}">
                    <label>Cập nhật lần cuối:</label>
                    <span
                      class="value"
                      th:text="${#temporals.format(withdrawal.updatedAt, 'dd/MM/yyyy HH:mm:ss')}"
                    ></span>
                  </div>
                  <div class="info-row" th:if="${withdrawal.deletedAt}">
                    <label>Ngày xóa:</label>
                    <span
                      class="value deleted-value"
                      th:text="${#temporals.format(withdrawal.deletedAt, 'dd/MM/yyyy HH:mm:ss')}"
                    ></span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Status History Section -->
          <!-- <div class="detail-card status-history">
            <div class="card-header">
              <h2>
                <i class="fas fa-history"></i>
                Lịch sử thay đổi trạng thái
              </h2>
            </div>
            <div class="card-content">
              <div class="timeline"> -->
          <!-- Current Status -->
          <!-- <div class="timeline-item current">
                  <div class="timeline-marker">
                    <i class="fas fa-circle"></i>
                  </div>
                  <div class="timeline-content">
                    <div class="timeline-header">
                      <span
                        class="timeline-status"
                        th:classappend="${'status-' + withdrawal.status.value}"
                      >
                        <span th:text="${withdrawal.status.displayName}"></span>
                      </span>
                      <span
                        class="timeline-time"
                        th:text="${withdrawal.updatedAt != null ? #temporals.format(withdrawal.updatedAt, 'dd/MM/yyyy HH:mm') : #temporals.format(withdrawal.createdAt, 'dd/MM/yyyy HH:mm')}"
                      ></span>
                    </div>
                    <div class="timeline-description">Trạng thái hiện tại</div>
                  </div>
                </div> -->

          <!-- Created Status -->
          <!-- <div class="timeline-item">
                  <div class="timeline-marker">
                    <i class="fas fa-plus-circle"></i>
                  </div>
                  <div class="timeline-content">
                    <div class="timeline-header">
                      <span class="timeline-status status-created">
                        Đã tạo
                      </span>
                      <span
                        class="timeline-time"
                        th:text="${#temporals.format(withdrawal.createdAt, 'dd/MM/yyyy HH:mm')}"
                      ></span>
                    </div>
                    <div class="timeline-description">
                      Withdrawal được tạo trong hệ thống
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div> -->

          <!-- Notes Section (show reasons, audit trail) -->
          <div class="detail-card notes-section">
            <div class="card-header">
              <h2>
                <i class="fas fa-sticky-note"></i>
                Ghi chú / Lý do
              </h2>
            </div>
            <div class="card-content">
              <div class="existing-notes" th:if="${withdrawal.notes}">
                <div
                  class="notes-content"
                  th:utext="${#strings.replace(withdrawal.notes, '\n', '<br/>')}"
                ></div>
              </div>
              <div class="no-notes" th:unless="${withdrawal.notes}">
                <i class="fas fa-info-circle"></i>
                <span>Chưa có ghi chú nào</span>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="detail-card action-buttons">
            <!-- <div class="card-header">
              <h2>
                <i class="fas fa-cogs"></i>
                Thao tác
              </h2>
            </div> -->
            <div class="card-content">
              <div class="button-group">
                <!-- Edit Button -->
                <a
                  th:href="@{/admin/withdrawals/{id}/edit(id=${withdrawal.id})}"
                  class="btn btn-primary"
                  th:classappend="${withdrawal.status.value == 'completed' ? ' btn-disabled' : ''}"
                >
                  <i class="fas fa-edit"></i>
                  Chỉnh sửa
                </a>

                <!-- Delete Button -->
                <a
                  th:href="@{/admin/withdrawals/{id}/delete(id=${withdrawal.id})}"
                  class="btn btn-danger"
                >
                  <i class="fas fa-trash"></i>
                  Xóa
                </a>

                <!-- Back to List Button -->
                <a th:href="@{/admin/withdrawals}" class="btn btn-secondary">
                  <i class="fas fa-arrow-left"></i>
                  Quay lại danh sách
                </a>

                <!-- Print Button -->
                <button
                  type="button"
                  class="btn btn-info"
                  onclick="printWithdrawal()"
                >
                  <i class="fas fa-print"></i>
                  In
                </button>

                <!-- Export Button -->
                <!-- <button
                  type="button"
                  class="btn btn-success"
                  onclick="exportWithdrawal()"
                >
                  <i class="fas fa-download"></i>
                  Xuất file
                </button> -->
              </div>

              <!-- Withdrawal Status Actions -->
              <div
                class="withdrawal-actions"
                th:if="${withdrawal.status.name() == 'PENDING'}"
              >
                <h4>Xử lý withdrawal</h4>
                <div class="status-buttons">
                  <form
                    th:action="@{/admin/withdrawals/{id}/process(id=${withdrawal.id})}"
                    method="post"
                    style="display: inline"
                  >
                    <button type="submit" class="btn btn-warning">
                      <i class="fas fa-play"></i>
                      Bắt đầu xử lý
                    </button>
                  </form>

                  <form
                    th:action="@{/admin/withdrawals/{id}/approve(id=${withdrawal.id})}"
                    method="post"
                    style="display: inline"
                  >
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-check"></i>
                      Approve
                    </button>
                  </form>

                  <button
                    type="button"
                    class="btn btn-danger js-reject-btn"
                    onclick="showRejectModal()"
                    style="display: inline"
                  >
                    <i class="fas fa-times"></i>
                    Reject
                  </button>
                </div>
              </div>

              <div
                class="withdrawal-actions"
                th:if="${withdrawal.status.name() == 'PROCESSING'}"
              >
                <h4>Xử lý withdrawal</h4>
                <div class="status-buttons">
                  <form
                    th:action="@{/admin/withdrawals/{id}/approve(id=${withdrawal.id})}"
                    method="post"
                    style="display: inline"
                  >
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-check"></i>
                      Approve
                    </button>
                  </form>

                  <button
                    type="button"
                    class="btn btn-danger js-reject-btn"
                    onclick="showRejectModal()"
                    style="display: inline"
                  >
                    <i class="fas fa-times"></i>
                    Reject
                  </button>
                </div>
              </div>

              <!-- Status Change Quick Actions -->
              <div class="quick-actions" th:if="${false}">
                <h4>Thay đổi trạng thái nhanh</h4>
                <div class="status-buttons">
                  <form
                    th:action="@{/admin/withdrawals/{id}/edit(id=${withdrawal.id})}"
                    method="post"
                    style="display: inline"
                  >
                    <input
                      type="hidden"
                      name="id"
                      th:value="${withdrawal.id}"
                    />
                    <input
                      type="hidden"
                      name="code"
                      th:value="${withdrawal.code}"
                    />
                    <input type="hidden" name="type" value="WITHDRAWAL" />
                    <input
                      type="hidden"
                      name="amount"
                      th:value="${withdrawal.amount}"
                    />
                    <input
                      type="hidden"
                      name="paymentMethod"
                      th:value="${withdrawal.paymentMethod}"
                    />
                    <input
                      type="hidden"
                      name="notes"
                      th:value="${withdrawal.notes}"
                    />
                    <input
                      type="hidden"
                      name="user.id"
                      th:value="${withdrawal.user.id}"
                    />
                    <input
                      type="hidden"
                      name="createdAt"
                      th:value="${withdrawal.createdAt}"
                    />
                    <input type="hidden" name="status" value="COMPLETED" />

                    <button
                      type="submit"
                      class="btn btn-success btn-sm"
                      th:if="${withdrawal.status.value != 'completed'}"
                    >
                      <i class="fas fa-check"></i>
                      Hoàn thành
                    </button>
                  </form>

                  <form
                    th:action="@{/admin/withdrawals/{id}/edit(id=${withdrawal.id})}"
                    method="post"
                    style="display: inline"
                  >
                    <input
                      type="hidden"
                      name="id"
                      th:value="${withdrawal.id}"
                    />
                    <input
                      type="hidden"
                      name="code"
                      th:value="${withdrawal.code}"
                    />
                    <input type="hidden" name="type" value="WITHDRAWAL" />
                    <input
                      type="hidden"
                      name="amount"
                      th:value="${withdrawal.amount}"
                    />
                    <input
                      type="hidden"
                      name="paymentMethod"
                      th:value="${withdrawal.paymentMethod}"
                    />
                    <input
                      type="hidden"
                      name="notes"
                      th:value="${withdrawal.notes}"
                    />
                    <input
                      type="hidden"
                      name="user.id"
                      th:value="${withdrawal.user.id}"
                    />
                    <input
                      type="hidden"
                      name="createdAt"
                      th:value="${withdrawal.createdAt}"
                    />
                    <input type="hidden" name="status" value="FAILED" />

                    <button
                      type="submit"
                      class="btn btn-danger btn-sm"
                      th:if="${withdrawal.status.value != 'failed'}"
                    >
                      <i class="fas fa-times"></i>
                      Thất bại
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Reject Modal -->
    <div
      id="rejectModal"
      class="modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99999;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(2px);
      "
    >
      <div
        class="modal-content"
        style="
          background: white;
          padding: 2rem;
          border-radius: 8px;
          max-width: 500px;
          width: 90%;
        "
      >
        <h3 style="margin-bottom: 1rem">Reject Withdrawal</h3>
        <form
          id="rejectForm"
          th:action="@{/admin/withdrawals/{id}/reject(id=${withdrawal.id})}"
          method="post"
        >
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />
          <div class="form-group" style="margin-bottom: 1rem">
            <label
              for="rejectReason"
              style="display: block; margin-bottom: 0.5rem; font-weight: 600"
              >Lý do reject:</label
            >
            <textarea
              id="rejectReason"
              name="rejectReason"
              required
              rows="3"
              placeholder="Nhập lý do reject..."
              style="
                width: 100%;
                padding: 0.5rem;
                border: 1px solid #ddd;
                border-radius: 4px;
              "
            ></textarea>
          </div>
          <div
            class="modal-actions"
            style="display: flex; gap: 1rem; justify-content: flex-end"
          >
            <button
              type="button"
              onclick="closeRejectModal()"
              class="btn btn-secondary"
            >
              Hủy
            </button>
            <button type="submit" class="btn btn-danger">Reject</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Scripts -->
    <div th:replace="~{fragments/admin/layout :: scripts}"></div>
    <script th:src="@{/js/admin/withdrawals.js}"></script>

    <script>
      // Page-specific functionality
      document.addEventListener("DOMContentLoaded", function () {
        initializeDetailPage();
      });

      function initializeDetailPage() {
        // Initialize AJAX form for adding notes
        const addNoteForm = document.getElementById("addNoteForm");
        if (addNoteForm) {
          addNoteForm.addEventListener("submit", handleAddNote);
        }

        // Ensure Reject buttons open the modal
        const rejectButtons = document.querySelectorAll(".js-reject-btn");
        rejectButtons.forEach(function (btn) {
          btn.addEventListener("click", function (e) {
            console.log("Reject button clicked");
            e.preventDefault();
            showRejectModal();
          });
        });

        // Attach submit listener to modal form for diagnostics
        const rejectForm = document.getElementById("rejectForm");
        if (rejectForm) {
          rejectForm.addEventListener("submit", function () {
            console.log("Submitting reject form to", rejectForm.action);
            const btn = rejectForm.querySelector('button[type="submit"]');
            if (btn) {
              btn.disabled = true;
              btn.innerHTML =
                '<i class="fas fa-spinner fa-spin"></i> Đang gửi...';
            }
          });
          const submitBtn = rejectForm.querySelector('button[type="submit"]');
          if (submitBtn) {
            submitBtn.addEventListener("click", function () {
              console.log("Reject modal submit button clicked");
            });
          }
        }
      }

      function handleAddNote(event) {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);
        const noteContent = formData.get("note");

        if (!noteContent.trim()) {
          showToast("Vui lòng nhập nội dung ghi chú", "error");
          return;
        }

        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Đang thêm...';

        // Submit via AJAX
        fetch(form.action, {
          method: "POST",
          body: formData,
          headers: {
            "X-Requested-With": "XMLHttpRequest",
          },
        })
          .then((response) => {
            if (response.ok) {
              // Reload page to show new note
              window.location.reload();
            } else {
              throw new Error("Network response was not ok");
            }
          })
          .catch((error) => {
            console.error("Error adding note:", error);
            showToast("Lỗi khi thêm ghi chú", "error");
          })
          .finally(() => {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
          });
      }

      function clearNoteForm() {
        document.getElementById("noteContent").value = "";
      }

      function printWithdrawal() {
        window.print();
      }

      function showRejectModal() {
        console.log("Opening reject modal");
        const modal = document.getElementById("rejectModal");
        if (!modal) {
          console.error("Modal not found");
          return;
        }

        // Force modal to show
        modal.style.display = "flex";
        modal.style.visibility = "visible";
        modal.style.opacity = "1";
        modal.style.zIndex = "99999";
        modal.classList.add("active");

        // Ensure modal content is visible
        const modalContent = modal.querySelector(".modal-content");
        if (modalContent) {
          modalContent.style.display = "block";
          modalContent.style.visibility = "visible";
        }

        // Auto-focus textarea
        try {
          const ta = document.getElementById("rejectReason");
          if (ta) {
            ta.focus();
            ta.addEventListener(
              "keydown",
              function (e) {
                if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
                  const form = document.getElementById("rejectForm");
                  if (form) form.submit();
                }
              },
              { once: true }
            );
          }
        } catch (_) {}

        console.log("Modal should be visible now");
      }

      function closeRejectModal() {
        const modal = document.getElementById("rejectModal");
        if (!modal) return;
        modal.classList.remove("active");
        modal.style.display = "none";
        modal.style.visibility = "hidden";
        modal.style.opacity = "0";
        document.getElementById("rejectReason").value = "";
      }

      function exportWithdrawal() {
        // Create export data
        const withdrawalData = {
          code: /*[[${withdrawal.code}]]*/ "",
          amount: /*[[${withdrawal.amount}]]*/ 0,
          status: /*[[${withdrawal.status.displayName}]]*/ "",
          user: /*[[${withdrawal.user.fullName}]]*/ "",
          createdAt:
            /*[[${#temporals.format(withdrawal.createdAt, 'dd/MM/yyyy HH:mm:ss')}]]*/ "",
        };

        // Create and download CSV
        const csvContent =
          "data:text/csv;charset=utf-8," +
          "Mã withdrawal,Số tiền,Trạng thái,Người dùng,Ngày tạo\n" +
          `${withdrawalData.code},${withdrawalData.amount},${withdrawalData.status},${withdrawalData.user},${withdrawalData.createdAt}`;

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `withdrawal_${withdrawalData.code}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        showToast("Đã xuất file thành công", "success");
      }

      function testReject() {
        console.log("Test reject function called");
        const withdrawalId = /*[[${withdrawal.id}]]*/ "";
        const csrfToken = document
          .querySelector('meta[name="_csrf"]')
          .getAttribute("content");
        const csrfHeader = document
          .querySelector('meta[name="_csrf_header"]')
          .getAttribute("content");

        console.log("Withdrawal ID:", withdrawalId);
        console.log("CSRF Token:", csrfToken);

        fetch(`/admin/withdrawals/${withdrawalId}/reject`, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            [csrfHeader]: csrfToken,
          },
          body: "rejectReason=Test reject from console",
        })
          .then((response) => {
            console.log("Response status:", response.status);
            console.log("Response ok:", response.ok);
            if (response.ok) {
              window.location.reload();
            } else {
              console.error("Reject failed");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      // Removed JS interception to allow native form submit for Reject
      // document.addEventListener("DOMContentLoaded", function () {
      //   document
      //     .querySelectorAll("button.btn.btn-danger")
      //     .forEach(function (btn) {
      //       if (
      //         btn.textContent &&
      //         btn.textContent.trim().toLowerCase() === "reject"
      //       ) {
      //         btn.addEventListener(
      //           "click",
      //           function (ev) {
      //             ev.preventDefault();
      //             openReject();
      //           },
      //           { once: false }
      //         );
      //       }
      //     });
      // });

      // Print styles
      const printStyles = `
        @media print {
          .admin-sidebar, .admin-header, .action-buttons, .add-note-form {
            display: none !important;
          }
          .admin-content {
            margin-left: 0 !important;
            padding: 20px !important;
          }
          .detail-container {
            box-shadow: none !important;
          }
        }
      `;

      // Add print styles to head
      const styleSheet = document.createElement("style");
      styleSheet.type = "text/css";
      styleSheet.innerText = printStyles;
      document.head.appendChild(styleSheet);
    </script>
  </body>
</html>
