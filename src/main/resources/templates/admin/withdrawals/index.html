<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý yêu cầu rút tiền - Admin</title>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />

    <!-- CSS Files -->
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/toast.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/withdrawals.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/withdrawals-index.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/notifications.css}"/>
    <meta name="flash-success" th:content="${successMessage}" th:if="${successMessage}"/>
    <meta name="flash-error" th:content="${errorMessage}" th:if="${errorMessage}"/>
    <meta name="flash-warning" th:content="${warning}" th:if="${warning}"/>
    <meta name="flash-info" th:content="${info}" th:if="${info}"/>
     <script th:src="@{/js/admin/flash-toast.js}"></script>
   <script th:src="@{/js/admin/notifications.js}"></script>
  </head>

  <body class="admin-body">
    <!-- Admin Header -->
    <div th:replace="~{fragments/admin/layout :: header}"></div>

    <!-- Admin Container -->
    <div class="admin-container">
      <!-- Sidebar -->
      <div th:replace="~{fragments/admin/sidebar :: admin-sidebar}"></div>

      <!-- Main Content -->
      <main class="admin-content">
        <!-- Admin Content Header -->
        <div class="admin-content-header">
          <div>
            <h1 class="admin-page-title">Quản lý yêu cầu rút tiền</h1>
            <div class="admin-breadcrumbs">
              <a th:href="@{/admin}">Admin</a>
              <span class="breadcrumb-separator">/</span>
              <a href="index.html">Quản lý doanh thu</a>
              <span class="breadcrumb-separator">/</span>
              <span>Yêu cầu rút tiền</span>
            </div>
          </div>
        </div>

        <!-- Statistics Overview -->
        <!-- <div
          th:replace="~{fragments/admin/withdrawals/withdrawal-stats :: withdrawal-stats}"
        ></div> -->

        <!-- Filters and Search -->
        <!-- <div
          th:replace="~{fragments/admin/withdrawals/withdrawal-filters :: withdrawal-filters}"
        ></div> -->

        <!-- Date Range Presets -->
        <!-- <div
          th:replace="~{fragments/admin/withdrawals/withdrawal-filters :: date-range-presets}"
        ></div> -->

        <!-- Bulk Actions -->
        <!-- <div
          th:replace="~{fragments/admin/withdrawals/withdrawal-actions :: bulk-actions}"
        ></div> -->
        <!-- Coin Package Management -->
        <div class="section-header">
          <!-- <h2>Quản lý gói xu</h2> -->
          <div class="section-actions">
            <div class="admin-content-actions">
              <a th:href="@{/admin/withdrawals/create}" class="primary-btn">
                <i class="fas fa-plus"></i>
                Tạo withdrawal mới
              </a>
            </div>
          </div>
        </div>
        <!-- Withdrawals Table -->
        <div class="data-container">
          <!-- Table with fragments -->
          <div
            th:replace="~{fragments/admin/withdrawals/withdrawal-table :: withdrawal-table}"
          ></div>

          <!-- Pagination -->
          <div class="pagination" th:if="${totalPages > 1}">
            <a
              th:href="@{/admin/withdrawals(page=${currentPage - 1}, size=${size}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword}, status=${status}, startDate=${startDate}, endDate=${endDate})}"
              class="pagination-btn"
              th:classappend="${isFirst ? 'disabled' : ''}"
              th:if="${!isFirst}"
            >
              <i class="fas fa-chevron-left"></i>
            </a>
            <span class="pagination-btn disabled" th:if="${isFirst}">
              <i class="fas fa-chevron-left"></i>
            </span>

            <div class="pagination-pages">
              <!-- First page -->
              <a
                th:if="${currentPage > 2}"
                th:href="@{/admin/withdrawals(page=0, size=${size}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword}, status=${status}, startDate=${startDate}, endDate=${endDate})}"
                class="pagination-btn"
                >1</a
              >

              <!-- Ellipsis before current page -->
              <span th:if="${currentPage > 3}" class="pagination-ellipsis"
                >...</span
              >

              <!-- Previous page -->
              <a
                th:if="${currentPage > 0}"
                th:href="@{/admin/withdrawals(page=${currentPage - 1}, size=${size}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword}, status=${status}, startDate=${startDate}, endDate=${endDate})}"
                class="pagination-btn"
                th:text="${currentPage}"
                >1</a
              >

              <!-- Current page -->
              <span class="pagination-btn active" th:text="${currentPage + 1}"
                >2</span
              >

              <!-- Next page -->
              <a
                th:if="${currentPage < totalPages - 1}"
                th:href="@{/admin/withdrawals(page=${currentPage + 1}, size=${size}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword}, status=${status}, startDate=${endDate})}"
                class="pagination-btn"
                th:text="${currentPage + 2}"
                >3</a
              >

              <!-- Ellipsis after current page -->
              <span
                th:if="${currentPage < totalPages - 4}"
                class="pagination-ellipsis"
                >...</span
              >

              <!-- Last page -->
              <a
                th:if="${currentPage < totalPages - 3}"
                th:href="@{/admin/withdrawals(page=${totalPages - 1}, size=${size}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword}, status=${status}, startDate=${startDate}, endDate=${endDate})}"
                class="pagination-btn"
                th:text="${totalPages}"
                >10</a
              >
            </div>

            <a
              th:href="@{/admin/withdrawals(page=${currentPage + 1}, size=${size}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword}, status=${status}, startDate=${startDate}, endDate=${endDate})}"
              class="pagination-btn"
              th:classappend="${isLast ? 'disabled' : ''}"
              th:if="${!isLast}"
            >
              <i class="fas fa-chevron-right"></i>
            </a>
            <span class="pagination-btn disabled" th:if="${isLast}">
              <i class="fas fa-chevron-right"></i>
            </span>
          </div>

          <!-- Page size selector -->
          <!-- <div class="page-size-selector">
            <label>Hiển thị:</label>
            <select
              onchange="changePageSize(this.value)"
              class="page-size-select"
            >
              <option value="10" th:selected="${size == 10}">10</option>
              <option value="25" th:selected="${size == 25}">25</option>
              <option value="50" th:selected="${size == 50}">50</option>
              <option value="100" th:selected="${size == 100}">100</option>
            </select>
            <span>mục mỗi trang</span>
          </div> -->
        </div>
      </main>
    </div>

    <!-- Flash Messages -->
    <div
      th:if="${successMessage}"
      class="toast toast-success"
      id="successToast"
    >
      <div class="toast-content">
        <i class="fas fa-check-circle"></i>
        <span th:text="${successMessage}">Thành công!</span>
      </div>
      <button class="toast-close" onclick="closeToast('successToast')">
        &times;
      </button>
    </div>

    <div th:if="${errorMessage}" class="toast toast-error" id="errorToast">
      <div class="toast-content">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${errorMessage}">Có lỗi xảy ra!</span>
      </div>
      <button class="toast-close" onclick="closeToast('errorToast')">
        &times;
      </button>
    </div>

    <div
      th:if="${warningMessage}"
      class="toast toast-warning"
      id="warningToast"
    >
      <div class="toast-content">
        <i class="fas fa-exclamation-triangle"></i>
        <span th:text="${warningMessage}">Cảnh báo!</span>
      </div>
      <button class="toast-close" onclick="closeToast('warningToast')">
        &times;
      </button>
    </div>

    <!-- Scripts -->
    <div th:replace="~{fragments/admin/layout :: scripts}"></div>
    <script th:src="@{/js/admin/withdrawals-index.js}"></script>

    <script th:inline="javascript">
      // JavaScript functions for the page
      function toggleSelectAll() {
        const selectAll = document.getElementById("selectAll");
        const checkboxes = document.querySelectorAll(".withdrawal-checkbox");
        checkboxes.forEach((checkbox) => {
          checkbox.checked = selectAll.checked;
        });
        updateBulkActions();
      }

      function updateBulkActions() {
        const checkboxes = document.querySelectorAll(
          ".withdrawal-checkbox:checked"
        );
        const bulkActions = document.getElementById("bulkActions");
        const selectedCount = document.getElementById("selectedCount");

        if (checkboxes.length > 0) {
          bulkActions.style.display = "block";
          selectedCount.textContent = checkboxes.length;

          // Add selected IDs to bulk form
          const form = document.getElementById("bulkActionForm");
          // Remove existing hidden inputs
          form
            .querySelectorAll('input[name="withdrawalIds"]')
            .forEach((input) => input.remove());

          // Add new hidden inputs
          checkboxes.forEach((checkbox) => {
            const hiddenInput = document.createElement("input");
            hiddenInput.type = "hidden";
            hiddenInput.name = "withdrawalIds";
            hiddenInput.value = checkbox.value;
            form.appendChild(hiddenInput);
          });
        } else {
          bulkActions.style.display = "none";
        }

        // Update select all checkbox
        const selectAll = document.getElementById("selectAll");
        const allCheckboxes = document.querySelectorAll(".withdrawal-checkbox");
        selectAll.checked =
          allCheckboxes.length > 0 &&
          checkboxes.length === allCheckboxes.length;
      }

      function clearSelection() {
        document
          .querySelectorAll(".withdrawal-checkbox")
          .forEach((checkbox) => {
            checkbox.checked = false;
          });
        document.getElementById("selectAll").checked = false;
        updateBulkActions();
      }

      function changePageSize(size) {
        const url = new URL(window.location);
        url.searchParams.set("size", size);
        url.searchParams.set("page", "0"); // Reset to first page
        window.location.href = url.toString();
      }

      function closeToast(toastId) {
        document.getElementById(toastId).style.display = "none";
      }

      // Auto-hide toasts after 5 seconds
      document.addEventListener("DOMContentLoaded", function () {
        const toasts = document.querySelectorAll(".toast");
        toasts.forEach((toast) => {
          setTimeout(() => {
            toast.style.display = "none";
          }, 5000);
        });
      });

      // Date range preset functionality
      document.querySelectorAll(".date-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          const range = this.dataset.range;
          const today = new Date();
          let startDate = "";
          let endDate = "";

          switch (range) {
            case "today":
              startDate = endDate = today.toISOString().split("T")[0];
              break;
            case "week":
              const weekStart = new Date(
                today.setDate(today.getDate() - today.getDay())
              );
              startDate = weekStart.toISOString().split("T")[0];
              endDate = new Date().toISOString().split("T")[0];
              break;
            case "month":
              startDate = new Date(today.getFullYear(), today.getMonth(), 1)
                .toISOString()
                .split("T")[0];
              endDate = new Date().toISOString().split("T")[0];
              break;
            case "quarter":
              const quarter = Math.floor(today.getMonth() / 3);
              startDate = new Date(today.getFullYear(), quarter * 3, 1)
                .toISOString()
                .split("T")[0];
              endDate = new Date().toISOString().split("T")[0];
              break;
            case "year":
              startDate = new Date(today.getFullYear(), 0, 1)
                .toISOString()
                .split("T")[0];
              endDate = new Date().toISOString().split("T")[0];
              break;
            case "all":
              startDate = endDate = "";
              break;
          }

          // Update form and submit
          const form = document.querySelector(".management-tools");
          const startInput = form.querySelector('input[name="startDate"]');
          const endInput = form.querySelector('input[name="endDate"]');

          if (startInput) startInput.value = startDate;
          if (endInput) endInput.value = endDate;

          // Update active button
          document
            .querySelectorAll(".date-btn")
            .forEach((b) => b.classList.remove("active"));
          this.classList.add("active");

          form.submit();
        });
      });
    </script>
  </body>
</html>
