<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chỉnh sửa tài liệu - EduShare Admin</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/toast.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin_documents.css}" />
     <link rel="stylesheet" th:href="@{/css/admin/notifications.css}"/>
    <style>
      /* CSS từ create.html */
      .content-container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 900px;
        padding: 24px;
        margin: 20px auto;
      }
      .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 16px;
        border-bottom: 1px solid #eee;
      }
      .content-header h3 {
        font-size: 1.75rem;
        font-weight: 700;
        color: #222;
        margin: 0;
      }
      .modal-tabs .tab-nav {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
      }
      .tab-btn {
        padding: 10px 16px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background: #f9f9f9;
        font-weight: 600;
        color: #555;
        transition: background 0.2s, color 0.2s, border-color 0.2s;
      }
      .tab-btn.active {
        background: #4f46e5;
        color: #fff;
        border-color: #4f46e5;
      }
      .tab-btn:hover {
        background: #eee;
      }
      .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        margin-bottom: 12px;
      }
      .form-group {
        flex: 1 1 48%;
        display: flex;
        flex-direction: column;
      }
      .form-group label {
        font-weight: 600;
        margin-bottom: 6px;
        color: #333;
      }
      input,
      select,
      textarea {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 1rem;
        transition: border-color 0.2s;
      }
      input:focus,
      select:focus,
      textarea:focus {
        border-color: #4f46e5;
        outline: none;
      }
      .file-upload {
        border: 2px dashed #ccc;
        padding: 20px;
        text-align: center;
        border-radius: 6px;
        transition: border-color 0.2s, background-color 0.2s;
        cursor: pointer;
        position: relative;
      }
      .file-upload:hover {
        border-color: #4f46e5;
        background-color: #f8f9ff;
      }
      .file-upload.drag-over {
        border-color: #4f46e5;
        background-color: #f0f4ff;
        border-style: solid;
      }
      .file-upload input[type="file"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }
      .file-info {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        margin-top: 8px;
      }
      .file-info i {
        color: #6c757d;
        font-size: 1.2rem;
      }
      .file-info .file-name {
        flex: 1;
        font-weight: 500;
        color: #333;
      }
      .file-info .file-size {
        color: #6c757d;
        font-size: 0.9rem;
      }
      .file-upload-label i {
        font-size: 2rem;
        color: #aaa;
      }
      .file-upload-label span {
        display: block;
        font-weight: 500;
        margin-top: 8px;
      }
      .btn-remove {
        background: none;
        border: none;
        color: #dc2626;
        cursor: pointer;
      }
      .btn-remove:hover {
        color: #991b1b;
      }
      .form-help {
        font-size: 0.85rem;
        color: #666;
      }
      .required {
        color: #dc2626;
      }
      .form-section {
        margin-bottom: 24px;
      }
      .form-section h5 {
        font-size: 1.1rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
      }
      .form-check {
        margin-bottom: 8px;
        display: flex;
        align-items: center;
      }
      .form-check-input {
        margin-right: 8px;
        width: 16px;
        height: 16px;
      }
      .form-check-label {
        cursor: pointer;
        margin-bottom: 0;
      }
      .form-check-label .text-muted {
        font-size: 0.85em;
        font-style: italic;
      }
      .categories-container {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
      }
      @media (max-width: 768px) {
        .categories-container {
          flex-direction: column;
          gap: 12px;
        }
      }
      .category-section {
        flex: 1;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        background: #f8f9fa;
      }
      .category-section-title {
        font-size: 1rem;
        font-weight: 600;
        color: #495057;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #dee2e6;
      }
      .category-section-title i {
        margin-right: 8px;
        width: 16px;
      }
      .category-group {
        background: white;
        border-radius: 6px;
        padding: 10px;
        max-height: 150px;
        overflow-y: auto;
      }
      .category-group .form-check {
        margin-bottom: 8px;
        padding: 4px 8px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }
      .category-group .form-check:hover {
        background-color: #f1f3f4;
      }
      .category-group .form-check-label i {
        margin-right: 8px;
        width: 16px;
      }
      .general-category:checked + label {
        font-weight: 600;
        color: #0d6efd;
      }
      .specific-category:checked + label {
        font-weight: 600;
        color: #198754;
      }
      .invalid-feedback {
        display: none;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 0.875rem;
        color: #dc3545;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 0.375rem;
        padding: 0.5rem 0.75rem;
      }
      .invalid-feedback.show {
        display: block;
      }
      .form-control.is-invalid {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
      }
      .categories-container.is-invalid {
        border: 2px solid #dc3545;
        border-radius: 8px;
      }
      .content-footer {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        padding-top: 16px;
        border-top: 1px solid #eee;
      }
      .tab-panel {
        display: none;
      }
      .tab-panel.active {
        display: block;
      }
      html {
        scroll-behavior: auto;
      }

      /* Info box styling - THÊM MỚI */
      .info-box {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
      }
      .info-box h5 {
        color: #495057;
        margin-bottom: 12px;
        font-size: 1rem;
        font-weight: 600;
      }
      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
      }
      .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e9ecef;
      }
      .info-item:last-child {
        border-bottom: none;
      }
      .info-label {
        font-weight: 500;
        color: #6c757d;
        font-size: 0.9rem;
      }
      .info-value {
        font-weight: 600;
        color: #495057;
        font-size: 0.9rem;
      }
      .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
        text-transform: uppercase;
      }
      .status-badge.draft {
        background: #fef3c7;
        color: #d97706;
      }
      .status-badge.pending {
        background: #dbeafe;
        color: #2563eb;
      }
      .status-badge.published {
        background: #d1fae5;
        color: #16a34a;
      }
      .status-badge.archived {
        background: #f3f4f6;
        color: #6b7280;
      }
    </style>
  </head>

  <body class="admin-page">
    <!-- Admin Header -->
    <div th:replace="~{fragments/admin/layout :: header}"></div>

    <!-- Admin Container -->
    <div class="admin-container">
      <!-- Sidebar -->
     <div th:replace="~{fragments/admin/sidebar :: admin-sidebar}"></div>

      <!-- Main Content -->
      <main class="admin-content">
        <div class="admin-content-header">
          <h1 class="admin-page-title">Chỉnh sửa tài liệu</h1>
          <div class="admin-breadcrumbs">
            <a href="/admin/documents">Admin</a>
            <span>/</span>
            <a href="/admin/documents">Tài liệu</a>
            <span>/</span>
            <span th:text="${document.title}">Tài liệu</span>
            <span>/</span>
            <span>Chỉnh sửa</span>
          </div>
        </div>

        <div class="content-container">
          <div class="content-header">
            <h3>Chỉnh sửa tài liệu</h3>
          </div>

          <!-- Hiển thị thông báo -->
          <div th:if="${success}" class="alert alert-success" role="alert">
            <i class="fas fa-check-circle"></i>
            <span th:text="${success}"></span>
          </div>
          <div th:if="${error}" class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-circle"></i>
            <span th:text="${error}"></span>
          </div>

          <!-- THÔNG TIN BỔ SUNG - Thông tin tài liệu hiện tại -->
          <div class="info-box">
            <h5>
              <i class="fas fa-info-circle"></i> Thông tin tài liệu hiện tại
            </h5>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">ID:</span>
                <span class="info-value" th:text="${document.id}">1</span>
              </div>
              <div class="info-item">
                <span class="info-label">Trạng thái:</span>
                <span
                  class="status-badge"
                  th:classappend="${#strings.toLowerCase(document.status)}"
                  th:text="${document.status == 'DRAFT' ? 'Bản nháp' : 
                                document.status == 'PENDING' ? 'Chờ duyệt' : 
                                document.status == 'PUBLISHED' ? 'Đã xuất bản' : 
                                document.status == 'ARCHIVED' ? 'Đã lưu trữ' : document.status}"
                  >PENDING</span
                >
              </div>
              <div class="info-item">
                <span class="info-label">Ngày tạo:</span>
                <span
                  class="info-value"
                  th:text="${#temporals.format(document.createdAt, 'dd/MM/yyyy HH:mm')}"
                  >01/01/2024 10:30</span
                >
              </div>
              <div class="info-item">
                <span class="info-label">Cập nhật lần cuối:</span>
                <span
                  class="info-value"
                  th:text="${#temporals.format(document.updatedAt, 'dd/MM/yyyy HH:mm')}"
                  >01/01/2024 10:30</span
                >
              </div>
            </div>
          </div>

          <div class="modal-body">
            <div class="modal-tabs">
              <div class="tab-nav">
                <button type="button" class="tab-btn active" data-tab="basic">
                  <i class="fas fa-info-circle"></i>
                  <span>Thông tin cơ bản</span>
                </button>
                <button type="button" class="tab-btn" data-tab="media">
                  <i class="fas fa-file-upload"></i>
                  <span>File & Media</span>
                </button>
                <button type="button" class="tab-btn" data-tab="advanced">
                  <i class="fas fa-cogs"></i>
                  <span>Cài đặt nâng cao</span>
                </button>
              </div>
            </div>

            <form
              id="documentForm"
              th:action="@{/admin/documents/{id}(id=${document.id})}"
              th:object="${document}"
              method="post"
              enctype="multipart/form-data"
              novalidate
            >
              <div class="tab-content">
                <!-- Tab 1: Basic Information -->
                <div class="tab-panel active" id="tabBasic">
                  <div class="form-section">
                    <h4><i class="fas fa-info-circle"></i> Thông tin cơ bản</h4>
                    <div class="form-row">
                      <div class="form-group">
                        <label for="documentTitle"
                          >Tiêu đề <span class="required">*</span></label
                        >
                        <input
                          type="text"
                          id="documentTitle"
                          name="title"
                          th:field="*{title}"
                          required
                          placeholder="Nhập tiêu đề tài liệu"
                          class="form-control"
                        />
                        <div
                          class="invalid-feedback"
                          id="titleError"
                          style="display: none"
                        >
                          Vui lòng nhập tiêu đề tài liệu
                        </div>
                        <div
                          class="invalid-feedback"
                          th:errors="*{title}"
                        ></div>
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label for="documentDescription">Mô tả</label>
                        <textarea
                          id="documentDescription"
                          name="description"
                          th:field="*{description}"
                          rows="4"
                          placeholder="Mô tả chi tiết về tài liệu..."
                          class="form-control"
                        ></textarea>
                      </div>
                    </div>
                    <!-- Phân loại tài liệu -->
                    <div class="form-row">
                      <div class="form-group" style="flex: 1 1 100%">
                        <label for="documentCategory"
                          >Phân loại tài liệu
                          <span class="required">*</span></label
                        >

                        <div class="categories-container">
                          <!-- Danh mục Tổng quát -->
                          <div class="category-section">
                            <h6 class="category-section-title">
                              <i class="fas fa-folder"></i> Danh mục Tổng quát
                            </h6>
                            <div class="category-group" id="generalCategories">
                              <div
                                th:each="category : ${categories}"
                                th:if="${category.parentId == null}"
                                class="form-check"
                              >
                                <input
                                  type="checkbox"
                                  th:id="'general_' + ${category.id}"
                                  th:value="${category.id}"
                                  th:data-parent-id="${category.parentId}"
                                  th:data-level="0"
                                  th:checked="${#lists.contains(document.categoryIds, category.id)}"
                                  class="form-check-input category-checkbox general-category"
                                />
                                <label
                                  th:for="'general_' + ${category.id}"
                                  class="form-check-label"
                                >
                                  <i
                                    class="fas fa-folder-open text-primary"
                                  ></i>
                                  <span th:text="${category.name}"></span>
                                </label>
                              </div>
                            </div>
                          </div>

                          <!-- Chuyên mục -->
                          <div class="category-section">
                            <h6 class="category-section-title">
                              <i class="fas fa-tags"></i> Chuyên mục
                            </h6>
                            <div class="category-group" id="specificCategories">
                              <div
                                th:each="category : ${categories}"
                                th:if="${category.parentId != null}"
                                class="form-check"
                              >
                                <input
                                  type="checkbox"
                                  th:id="'specific_' + ${category.id}"
                                  th:value="${category.id}"
                                  th:data-parent-id="${category.parentId}"
                                  th:data-level="1"
                                  th:checked="${#lists.contains(document.categoryIds, category.id)}"
                                  class="form-check-input category-checkbox specific-category"
                                />
                                <label
                                  th:for="'specific_' + ${category.id}"
                                  class="form-check-label"
                                >
                                  <i class="fas fa-tag text-success"></i>
                                  <span th:text="${category.name}"></span>
                                  <span
                                    th:if="${category.parentName != null}"
                                    class="text-muted small"
                                  >
                                    (thuộc:
                                    <span
                                      th:text="${category.parentName}"
                                    ></span
                                    >)
                                  </span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div
                          class="invalid-feedback"
                          id="categoryError"
                          style="display: none"
                        >
                          Vui lòng chọn ít nhất một danh mục để phân loại tài
                          liệu
                        </div>
                        <small class="form-text text-muted">
                          <i class="fas fa-info-circle"></i>
                          Chọn từ 1-15 mục.
                          <strong>Danh mục Tổng quát</strong> (1 mục) +
                          <strong>Chuyên mục</strong> (có thể nhiều mục) để phân
                          loại chi tiết.
                        </small>
                        <input
                          type="hidden"
                          id="selectedCategoryIds"
                          name="categoryIdsString"
                          th:value="${#strings.listJoin(document.categoryIds, ',')}"
                        />
                      </div>
                    </div>

                    <!-- Tag - Xuống dưới riêng -->
                    <div class="form-row">
                      <div class="form-group">
                        <label for="documentTags">
                          <i class="fas fa-hashtag"></i>
                          Tag (nhập tên tag, cách nhau bằng dấu phẩy)
                        </label>
                        <input
                          type="text"
                          id="documentTags"
                          name="tagNames"
                          th:value="${#strings.listJoin(document.tagNames, ', ')}"
                          placeholder="java, spring-boot, tutorial, backend"
                          class="form-control"
                        />
                        <small class="form-text text-muted">
                          <i class="fas fa-lightbulb"></i>
                          Ví dụ: java, spring-boot, tutorial, backend (giúp tìm
                          kiếm dễ dàng hơn)
                        </small>
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label for="documentPrice">Giá (coin)</label>
                        <input
                          type="number"
                          id="documentPrice"
                          name="price"
                          th:field="*{price}"
                          min="0"
                          placeholder="0 = Miễn phí"
                          class="form-control"
                        />
                      </div>
                      <div class="form-group">
                        <label for="documentStatus">Trạng thái</label>
                        <select
                          id="documentStatus"
                          name="status"
                          th:field="*{status}"
                          class="form-control"
                        >
                          <option value="DRAFT">Bản nháp</option>
                          <option value="PENDING">Chờ duyệt</option>
                          <option value="PUBLISHED">Đã xuất bản</option>
                          <option value="ARCHIVED">Đã lưu trữ</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Tab 2: File & Media -->
                <div class="tab-panel" id="tabMedia">
                  <div class="form-section">
                    <h4><i class="fas fa-file-upload"></i> File và Media</h4>

                    <!-- Hiển thị file hiện tại nếu có -->
                    <div
                      th:if="${document.fileName}"
                      class="file-info"
                      style="display: block"
                    >
                      <i
                        class="fas fa-file-pdf"
                        th:if="${#strings.endsWith(document.fileName, '.pdf')}"
                      ></i>
                      <i
                        class="fas fa-file-word"
                        th:if="${#strings.endsWith(document.fileName, '.doc') or #strings.endsWith(document.fileName, '.docx')}"
                      ></i>
                      <i
                        class="fas fa-file-powerpoint"
                        th:if="${#strings.endsWith(document.fileName, '.ppt') or #strings.endsWith(document.fileName, '.pptx')}"
                      ></i>
                      <i
                        class="fas fa-file-excel"
                        th:if="${#strings.endsWith(document.fileName, '.xls') or #strings.endsWith(document.fileName, '.xlsx')}"
                      ></i>
                      <i
                        class="fas fa-file"
                        th:unless="${#strings.endsWith(document.fileName, '.pdf') or #strings.endsWith(document.fileName, '.doc') or #strings.endsWith(document.fileName, '.docx') or #strings.endsWith(document.fileName, '.ppt') or #strings.endsWith(document.fileName, '.pptx') or #strings.endsWith(document.fileName, '.xls') or #strings.endsWith(document.fileName, '.xlsx')}"
                      ></i>
                      <span class="file-name" th:text="${document.fileName}"
                        >document.pdf</span
                      >
                      <span
                        class="file-size"
                        th:text="${document.fileSize != null ? document.fileSize + ' KB' : 'N/A'}"
                        >2.5 MB</span
                      >
                      <small class="text-muted">(File hiện tại)</small>
                    </div>

                    <div class="form-row">
                      <div class="form-group">
                        <label for="documentFile"
                          >Thay đổi file tài liệu (tùy chọn)</label
                        >
                        <div class="file-upload">
                          <input
                            type="file"
                            id="documentFile"
                            name="file"
                            accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx"
                            class="form-control"
                          />
                          <div class="file-upload-label">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Chọn file mới hoặc kéo thả vào đây</span>
                            <small
                              >Hỗ trợ: PDF, Word, PowerPoint, Excel (tối đa
                              100MB)</small
                            >
                          </div>
                        </div>
                        <div
                          class="file-info"
                          id="fileInfo"
                          style="display: none"
                        >
                          <i class="fas fa-file"></i>
                          <span class="file-name"></span>
                          <span class="file-size"></span>
                          <button
                            type="button"
                            class="btn-remove"
                            title="Xóa file"
                          >
                            <i class="fas fa-times"></i>
                          </button>
                        </div>
                        <small class="form-text text-muted">
                          <i class="fas fa-info-circle"></i>
                          Để trống nếu không muốn thay đổi file hiện tại
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Tab 3: Advanced Settings -->
                <div class="tab-panel" id="tabAdvanced">
                  <div class="form-section">
                    <h4><i class="fas fa-cogs"></i> Cài đặt nâng cao</h4>
                    <p class="text-muted">
                      Các tính năng nâng cao sẽ được bổ sung trong phiên bản
                      tương lai.
                    </p>
                  </div>
                </div>
              </div>
              <input type="hidden" id="documentId" name="id" th:field="*{id}" />
            </form>
          </div>
          <div class="content-footer">
            <a th:href="@{/admin/documents}" class="btn btn-outline">Hủy</a>
            <button type="submit" class="btn btn-primary" form="documentForm">
              <i class="fas fa-save"></i>
              <span>Cập nhật tài liệu</span>
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
     <script th:src="@{/js/admin/notifications.js}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("documentForm");
        const documentFile = document.getElementById("documentFile");
        const fileInfo = document.getElementById("fileInfo");

        // Tab switching functionality
        const tabBtns = document.querySelectorAll(".tab-btn");
        const tabPanels = document.querySelectorAll(".tab-panel");

        tabBtns.forEach((btn) => {
          btn.addEventListener("click", function () {
            const targetTab = this.getAttribute("data-tab");

            // Remove active class from all tabs and panels
            tabBtns.forEach((b) => b.classList.remove("active"));
            tabPanels.forEach((p) => p.classList.remove("active"));

            // Add active class to clicked tab and corresponding panel
            this.classList.add("active");
            document
              .getElementById(
                "tab" + targetTab.charAt(0).toUpperCase() + targetTab.slice(1)
              )
              .classList.add("active");
          });
        });

        // File upload handling
        if (documentFile) {
          documentFile.addEventListener("change", function () {
            const file = this.files[0];
            if (file) {
              const fileName = file.name;
              const fileSize = (file.size / 1024 / 1024).toFixed(2) + " MB";

              fileInfo.querySelector(".file-name").textContent = fileName;
              fileInfo.querySelector(".file-size").textContent = fileSize;
              fileInfo.style.display = "flex";

              // Update file icon based on extension
              const extension = fileName.split(".").pop().toLowerCase();
              const icon = fileInfo.querySelector("i");
              icon.className = "fas fa-file";

              switch (extension) {
                case "pdf":
                  icon.className = "fas fa-file-pdf";
                  break;
                case "doc":
                case "docx":
                  icon.className = "fas fa-file-word";
                  break;
                case "ppt":
                case "pptx":
                  icon.className = "fas fa-file-powerpoint";
                  break;
                case "xls":
                case "xlsx":
                  icon.className = "fas fa-file-excel";
                  break;
              }
            } else {
              fileInfo.style.display = "none";
            }
          });

          // Remove file button
          const removeBtn = fileInfo.querySelector(".btn-remove");
          if (removeBtn) {
            removeBtn.addEventListener("click", function () {
              documentFile.value = "";
              fileInfo.style.display = "none";
            });
          }
        }

        // Function để hiển thị lỗi inline
        function showInlineError(errorId, message) {
          const errorDiv = document.getElementById(errorId);
          if (errorDiv) {
            errorDiv.textContent = message;
            errorDiv.style.display = "block";
            // Tự động ẩn sau 3 giây
            setTimeout(() => {
              errorDiv.style.display = "none";
            }, 3000);
          }
        }

        // Function để ẩn lỗi inline
        function hideInlineError(errorId) {
          const errorDiv = document.getElementById(errorId);
          if (errorDiv) {
            errorDiv.style.display = "none";
          }
        }

        // Category selection handling
        const categoryCheckboxes =
          document.querySelectorAll(".category-checkbox");
        const selectedCategoryIds = document.getElementById(
          "selectedCategoryIds"
        );

        function updateSelectedCategories() {
          const selected = [];
          categoryCheckboxes.forEach((checkbox) => {
            if (checkbox.checked) {
              selected.push(checkbox.value);
            }
          });
          selectedCategoryIds.value = selected.join(",");
        }

        // Enhanced category selection with general category restriction
        categoryCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            const isChecked = this.checked;

            if (isChecked) {
              const checkedBoxes = document.querySelectorAll(
                ".category-checkbox:checked"
              );

              // Kiểm tra số lượng danh mục tổng cộng
              if (checkedBoxes.length > 15) {
                this.checked = false;
                showInlineError(
                  "categoryError",
                  "Bạn chỉ có thể chọn ( Danh mục Tổng quát(1) + Chuyên mục(14) ) tối đa là 15 danh mục!"
                );
                return;
              }

              // Logic đặc biệt: Chỉ cho phép chọn 1 danh mục tổng quát
              if (this.classList.contains("general-category")) {
                const otherGeneralChecked = document.querySelectorAll(
                  ".general-category:checked"
                );
                if (otherGeneralChecked.length > 1) {
                  // Bỏ chọn các danh mục tổng quát khác
                  otherGeneralChecked.forEach((cb) => {
                    if (cb !== this) {
                      cb.checked = false;
                    }
                  });
                }
              }
            }

            // Cập nhật hidden field
            updateSelectedCategories();
          });
        });

        // Initialize selected categories
        updateSelectedCategories();

        // Form validation
        form.addEventListener("submit", function (e) {
          let isValid = true;

          // Validate title
          const title = document.getElementById("documentTitle");
          const titleError = document.getElementById("titleError");
          if (!title.value.trim()) {
            titleError.style.display = "block";
            title.classList.add("is-invalid");
            isValid = false;
          } else {
            titleError.style.display = "none";
            title.classList.remove("is-invalid");
          }

          // Validate categories
          const categoryError = document.getElementById("categoryError");
          const selectedCategories = selectedCategoryIds.value
            .split(",")
            .filter((id) => id.trim());
          if (selectedCategories.length === 0) {
            categoryError.style.display = "block";
            document
              .querySelector(".categories-container")
              .classList.add("is-invalid");
            isValid = false;
          } else if (selectedCategories.length > 15) {
            categoryError.textContent = "Bạn chỉ có thể chọn ( Danh mục Tổng quát(1) + Chuyên mục(14) ) tối đa là 15 danh mục!";
            categoryError.style.display = "block";
            document
              .querySelector(".categories-container")
              .classList.add("is-invalid");
            isValid = false;
          } else {
            categoryError.style.display = "none";
            document
              .querySelector(".categories-container")
              .classList.remove("is-invalid");
          }

          if (!isValid) {
            e.preventDefault();
            // Switch to basic tab if validation fails
            document.querySelector('[data-tab="basic"]').click();
          }
        });

        // Drag and drop for file upload
        const fileUpload = document.querySelector(".file-upload");
        if (fileUpload) {
          ["dragenter", "dragover", "dragleave", "drop"].forEach(
            (eventName) => {
              fileUpload.addEventListener(eventName, preventDefaults, false);
            }
          );

          function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
          }

          ["dragenter", "dragover"].forEach((eventName) => {
            fileUpload.addEventListener(eventName, highlight, false);
          });

          ["dragleave", "drop"].forEach((eventName) => {
            fileUpload.addEventListener(eventName, unhighlight, false);
          });

          function highlight(e) {
            fileUpload.classList.add("drag-over");
          }

          function unhighlight(e) {
            fileUpload.classList.remove("drag-over");
          }

          fileUpload.addEventListener("drop", handleDrop, false);

          function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
              documentFile.files = files;
              documentFile.dispatchEvent(new Event("change"));
            }
          }
        }
      });

      // Toast notification function
      function showNotification(message, type = "info") {
        const toast = document.createElement("div");
        toast.className = `alert alert-${
          type === "success" ? "success" : "danger"
        } alert-dismissible fade show`;

        const bgColor = type === "success" ? "#d1e7dd" : "#f8d7da";
        const borderColor = type === "success" ? "#badbcc" : "#f5c2c7";
        const textColor = type === "success" ? "#0f5132" : "#842029";

        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 9999;
          min-width: 300px;
          padding: 12px 16px;
          margin-bottom: 1rem;
          border: 1px solid ${borderColor};
          border-radius: 8px;
          background-color: ${bgColor};
          color: ${textColor};
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
          font-size: 14px;
          line-height: 1.5;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          display: flex;
          align-items: center;
          gap: 8px;
          animation: slideIn 0.3s ease-out;
        `;

        const icon = type === "success" ? "✓" : "⚠";
        toast.innerHTML = `
          <span style="font-weight: bold; font-size: 16px;">${icon}</span>
          <span>${message}</span>
          <button type="button" class="btn-close" style="margin-left: auto; background: none; border: none; font-size: 18px; cursor: pointer; color: ${textColor};" onclick="this.parentElement.remove()">×</button>
        `;

        // Add keyframe animation
        if (!document.getElementById("toast-animations")) {
          const style = document.createElement("style");
          style.id = "toast-animations";
          style.textContent = `
            @keyframes slideIn {
              from { transform: translateX(100%); opacity: 0; }
              to { transform: translateX(0); opacity: 1; }
            }
          `;
          document.head.appendChild(style);
        }

        document.body.appendChild(toast);

        // Auto remove after 5 seconds
        setTimeout(() => {
          if (toast.parentElement) {
            toast.remove();
          }
        }, 5000);
      }

      // Show flash messages as toast notifications
      document.addEventListener("DOMContentLoaded", function () {
        // Success messages
        const successMessage = /*[[${success}]]*/ null;
        if (successMessage) {
          showNotification(successMessage, "success");
        }

        // Error messages
        const errorMessage = /*[[${error}]]*/ null;
        if (errorMessage) {
          showNotification(errorMessage, "error");
        }
      });
    </script>
  </body>
</html>
