<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thống kê - EduShare Admin</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin_users.css}" />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" th:href="@{/css/admin/toast.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/statistics.css}" />
     <link rel="stylesheet" th:href="@{/css/admin/notifications.css}"/>
  <script th:src="@{/js/admin/notifications.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
      .dropdown select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;

        background-color: #f9f9f9;
        border: 1px solid #ccc;
        padding: 6px 38px 6px 12px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
        outline: none;
        transition: border-color 0.2s ease;

        background-image: url("data:image/svg+xml;utf8,<svg fill='gray' height='12' viewBox='0 0 24 24' width='12' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 12px;
      }

      .dropdown select:hover,
      .dropdown select:focus {
        border-color: #4361ee;
        background-color: #fff;
      }
    </style>
  </head>

  <body class="admin-body">
    <!-- Admin Header -->
    <div th:replace="~{fragments/admin/layout :: header}"></div>

    <!-- Admin Container -->
    <div class="admin-container">
      <!-- Sidebar -->
      <div th:replace="~{fragments/admin/sidebar :: admin-sidebar}"></div>

      <!-- Main Content -->
      <main class="admin-content">
        <div class="admin-content-header">
          <h1 class="admin-page-title">Thống kê</h1>
          <div class="admin-breadcrumbs">
            <a href="/admin">Admin</a>
            <span>/</span>
            <span>Thống kê</span>
          </div>
        </div>

        <!-- Date Range Picker -->
        <div class="date-filter">
          <div class="date-picker">
            <div class="date-inputs">
              <div class="date-field">
                <label for="startDate">Từ ngày</label>
                <input type="date" id="startDate" />
              </div>
              <div class="date-separator"></div>
              <div class="date-field">
                <label for="endDate">Đến ngày</label>
                <input type="date" id="endDate" />
              </div>
            </div>
          </div>
          <div class="time-presets">
            <button class="time-preset" data-days="30">30 ngày</button>
            <button class="time-preset" data-days="90">3 tháng</button>
            <button class="time-preset" data-days="180">6 tháng</button>
            <button class="time-preset" data-days="365">1 năm</button>
          </div>
          <button class="apply-filter-btn">Áp dụng</button>
        </div>

        <!-- Stats Summary -->
        <div class="stats-summary">
          <div class="stat-card">
            <div class="stat-icon users-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <div class="stat-title">Người dùng mới</div>
              <div class="stat-value" id="userCount">-</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon documents-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-content">
              <div class="stat-title">Tài liệu đăng mới</div>
              <div class="stat-value" id="documentCount">-</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon users-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <div class="stat-title">Lượt tải</div>
              <div class="stat-value">--</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon documents-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-content">
              <div class="stat-title">Doanh thu</div>
              <div class="stat-value" id="revenueAmount">-</div>
            </div>
          </div>
        </div>

        <!-- Main Charts -->
        <div class="analytics-grid">
          <!-- Traffic Chart -->
          <div class="analytics-card double-width">
            <div class="analytics-header">
              <h3>Lượt truy cập</h3>
              <div class="analytics-actions">
                <div class="chart-type-toggle">
                  <button class="chart-type active" data-type="line">
                    <i class="fas fa-chart-line"></i>
                  </button>
                  <button class="chart-type" data-type="bar">
                    <i class="fas fa-chart-bar"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="analytics-content">
              <div class="chart-container">
                <canvas id="trafficChart"></canvas>
              </div>
              <div class="chart-legend">
                <div class="legend-item">
                  <div
                    class="legend-color"
                    style="background-color: var(--success)"
                  ></div>
                  <div class="legend-label">Người dùng mới</div>
                </div>
              </div>
            </div>
          </div>

          <!-- User Growth Chart -->
          <div class="analytics-card">
            <div class="analytics-header">
              <h3>Tăng trưởng người dùng</h3>
              <div class="dropdown">
                <select id="userGrowthTimeRange">
                  <option value="180">6 Tháng</option>
                  <option value="365">1 Năm</option>
                </select>
              </div>
            </div>
            <div class="analytics-content">
              <div class="chart-container">
                <canvas id="userGrowthChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Category Distribution Pie Chart -->
          <div class="analytics-card">
            <div class="analytics-header">
              <h3>Phân bố theo danh mục</h3>
            </div>
            <div class="analytics-content">
              <div class="chart-container">
                <canvas id="categoryDistributionChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Document Type Donut Chart -->
          <div class="analytics-card">
            <div class="analytics-header">
              <h3>Phân loại tài liệu</h3>
            </div>
            <div class="analytics-content">
              <div class="chart-container">
                <canvas id="documentTypeChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Top Documents Table -->
          <div class="analytics-card">
            <div class="analytics-header">
              <h3>Tài liệu phổ biến nhất</h3>
            </div>
            <div class="analytics-content">
              <table class="analytics-table">
                <thead>
                  <tr>
                    <th>Tài liệu</th>
                    <th>Danh mục</th>
                    <th>Lượt tải</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="doc : ${documents}">
                    <td>
                      <div class="table-document">
                        <div class="document-title" th:text="${doc.title}">
                          Tên tài liệu
                        </div>
                      </div>
                    </td>
                    <td>Lập trình</td>
                    <td>12</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Revenue Chart -->
          <div class="analytics-card double-width">
            <div class="analytics-header">
              <h3>Doanh thu</h3>
              <div class="analytics-actions">
                <div class="chart-type-toggle">
                  <button class="chart-type active" data-type="bar">
                    <i class="fas fa-chart-bar"></i>
                  </button>
                  <button class="chart-type" data-type="line">
                    <i class="fas fa-chart-line"></i>
                  </button>
                </div>
                <div class="dropdown">
                  <select id="revenueTimeRange">
                    <option value="30">30 Ngày</option>
                    <option value="90">3 Tháng</option>
                    <option value="180">6 Tháng</option>
                    <option value="365">1 Năm</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="analytics-content">
              <div class="chart-container">
                <canvas id="revenueChart"></canvas>
              </div>
              <div class="chart-stats">
                <div class="stat-item">
                  <div class="stat-value">562.8K</div>
                  <div class="stat-label">Tổng doanh thu</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">168.8K</div>
                  <div class="stat-label">Doanh thu cao nhất (tháng 3)</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">94K</div>
                  <div class="stat-label">Doanh thu trung bình/tháng</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script th:src="@{/js/main.js}"></script>
    <script th:src="@{/js/admin/admin.js}"></script>
    <script th:src="@{/js/admin/statistics.js}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const dropdownToggle = document.querySelector(".dropdown-toggle");
        const dropdownMenu = document.querySelector(".dropdown-menu");
        const dropdownLabel = dropdownToggle.querySelector("span");

        dropdownToggle.addEventListener("click", (e) => {
          e.stopPropagation();
          dropdownMenu.style.display =
            dropdownMenu.style.display === "block" ? "none" : "block";
        });

        dropdownMenu.querySelectorAll("li").forEach((item) => {
          item.addEventListener("click", () => {
            dropdownLabel.textContent = item.textContent;

            dropdownMenu
              .querySelectorAll("li")
              .forEach((li) => li.classList.remove("active"));
            item.classList.add("active");

            dropdownMenu.style.display = "none";

            console.log(
              "Chọn khoảng thời gian:",
              item.getAttribute("data-months"),
              "tháng"
            );
          });
        });

        document.addEventListener("click", () => {
          dropdownMenu.style.display = "none";
        });
      });
    </script>
  </body>
</html>
