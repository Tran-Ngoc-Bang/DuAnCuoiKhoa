<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <title>Quản lý danh mục - EduShare Admin</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/categories.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/toast.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/notifications.css}" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css"
    />
    <style type="text/css">
      .pagination-btn.disabled {
        pointer-events: none;
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Compact table styling - chỉ áp dụng cho table view */
      #tableView .data-table {
        font-size: 0.9rem;
      }
      #tableView .data-table th,
      #tableView .data-table td {
        padding: 8px 12px !important;
        vertical-align: middle;
      }
      #tableView .data-table th {
        font-size: 0.85rem;
        font-weight: 600;
      }
      #tableView .category-info {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      #tableView .category-icon {
        font-size: 1rem;
        color: #4361ee;
      }
      #tableView .category-name {
        font-size: 0.9rem;
        margin: 0;
        font-weight: 500;
      }
      #tableView .stat-item {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.85rem;
      }
      #tableView .stat-item i {
        font-size: 0.8rem;
        color: #6c757d;
      }
      #tableView .status-badge {
        font-size: 0.75rem;
        padding: 4px 8px;
      }
      #tableView .action-buttons {
        display: flex;
        gap: 4px;
      }
      #tableView .action-btn {
        padding: 6px 8px;
        font-size: 0.8rem;
      }
      #tableView .checkbox-wrapper {
        transform: scale(0.9);
      }

      /* Grid view styling - giữ nguyên kích thước bình thường */
      #gridView .category-admin-card {
        font-size: 1rem;
        padding: 1.5rem;
      }
      #gridView .category-admin-title {
        font-size: 1.1rem;
        font-weight: 600;
      }
      #gridView .category-admin-description {
        font-size: 0.9rem;
      }
      #gridView .stat-item {
        font-size: 0.9rem;
      }
      #gridView .stat-item i {
        font-size: 1rem;
      }
      #gridView .status-badge {
        font-size: 0.8rem;
        padding: 6px 12px;
      }
      #gridView .action-buttons {
        gap: 8px;
      }
      #gridView .action-btn {
        padding: 8px 12px;
        font-size: 0.9rem;
      }

      /* Success and Error Messages */
      .success-message {
        background-color: #f0fdf4;
        border: 1px solid #bbf7d0;
        color: #16a34a;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
      }
      .success-message i {
        color: #16a34a;
        font-size: 1.1rem;
      }
      .error-message {
        background-color: #fef2f2;
        border: 1px solid #fecaca;
        color: #dc2626;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
      }
      .error-message i {
        color: #dc2626;
        font-size: 1.1rem;
      }

      /* Category Tabs */
      .category-tabs {
        display: flex;
        gap: 0;
        margin-bottom: 24px;
        border-bottom: 2px solid #e5e7eb;
      }

      .tab-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        text-decoration: none;
        color: #6b7280;
        font-weight: 500;
        border-bottom: 3px solid transparent;
        transition: all 0.2s;
        position: relative;
      }

      .tab-item:hover {
        color: #4361ee;
        background-color: #f8fafc;
      }

      .tab-item.active {
        color: #4361ee;
        border-bottom-color: #4361ee;
        background-color: #f0f4ff;
      }

      .tab-count {
        background: #e5e7eb;
        color: #6b7280;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 2px 6px;
        border-radius: 10px;
        min-width: 20px;
        text-align: center;
      }

      .tab-item.active .tab-count {
        background: #4361ee;
        color: white;
      }

      /* Hierarchical Category Styling */
      .category-name {
        font-family: "Courier New", monospace;
        white-space: pre;
      }

      /* Parent category styling */
      .category-info .category-details h4:not([style*="color: #6c757d"]) {
        font-weight: 600;
        color: #2d3748;
      }

      /* Child category styling */
      .category-info .category-details h4[style*="color: #6c757d"] {
        font-weight: 500;
        margin-left: 0;
      }

      /* Grid view hierarchy styling */
      #gridView .category-admin-title:not([style*="color: #6c757d"]) {
        font-weight: 600;
        color: #2d3748;
      }

      #gridView .category-admin-title[style*="color: #6c757d"] {
        font-weight: 500;
        font-family: "Courier New", monospace;
        white-space: pre;
      }

      /* Deleted category styling */
      .category-admin-card[data-deleted="true"] {
        opacity: 0.7;
        border-left: 4px solid #dc2626;
      }

      .category-admin-card[data-deleted="true"] .category-admin-title {
        text-decoration: line-through;
        color: #6b7280 !important;
      }

      /* Action button colors */
      .action-btn.success {
        background: #16a34a;
        color: white;
      }

      .action-btn.success:hover {
        background: #15803d;
      }

      .add-new-btn.success {
        background: #16a34a;
        color: white;
      }

      .add-new-btn.success:hover {
        background: #15803d;
      }

      /* Disabled button styling */
      .add-new-btn.disabled {
        background: #9ca3af !important;
        color: #6b7280 !important;
        cursor: not-allowed !important;
        opacity: 0.6;
      }

      .add-new-btn.disabled:hover {
        background: #9ca3af !important;
        transform: none !important;
      }

      /* Enhanced visual hierarchy for parent-child categories */
      .parent-info {
        display: flex;
        align-items: center;
        gap: 4px;
        margin-top: 2px;
      }

      /* Deleted category styling */
      .category-admin-card[data-deleted="true"] {
        opacity: 0.7;
        border-left: 4px solid #dc2626 !important;
      }

      .category-admin-card[data-deleted="true"] .category-admin-title {
        text-decoration: line-through;
        color: #6b7280 !important;
      }

      /* Enhanced typography for hierarchy */
      .category-admin-title {
        margin: 0;
        line-height: 1.4;
        transition: color 0.2s ease;
      }

      /* Child category visual styling */
      .category-admin-card .parent-info + * {
        margin-top: 8px;
      }

      /* Enhanced visual hierarchy for child categories */
      .category-admin-card:has(.parent-info) {
        margin-left: 30px;
        margin-top: 8px;
        border-left: 3px solid #cbd5e1;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        position: relative;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        /* Giữ nguyên size, chỉ thay đổi padding để tạo cảm giác nhỏ hơn */
        padding: 1.2rem; /* Nhỏ hơn so với default 1.5rem */
      }

      .category-admin-card:has(.parent-info)::before {
        content: "";
        position: absolute;
        left: -15px;
        top: 20px;
        width: 12px;
        height: 2px;
        background: #cbd5e1;
      }

      .category-admin-card:has(.parent-info)::after {
        content: "";
        position: absolute;
        left: -15px;
        top: -8px;
        width: 2px;
        height: 28px;
        background: #cbd5e1;
      }

      /* Parent category enhanced styling */
      .category-admin-card:not(:has(.parent-info)) {
        border-left: 4px solid #4361ee;
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 4px;
        padding: 1.5rem; /* Đảm bảo padding đồng nhất */
      }

      /* Đảm bảo tất cả card có min-height đồng nhất */
      .category-admin-card {
        min-height: 200px;
        display: flex;
        flex-direction: column;
      }

      .category-admin-content {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .category-stats {
        margin-top: auto;
        margin-bottom: 1rem;
      }

      .category-admin-status {
        margin-top: auto;
      }

      /* Typography improvements */
      .category-admin-card:not(:has(.parent-info)) .category-admin-title {
        font-weight: 600;
        font-size: 1.1rem;
        color: #1e293b;
      }

      .category-admin-card:has(.parent-info) .category-admin-title {
        font-weight: 500;
        font-size: 1rem; /* Giữ size tương đương */
        color: #64748b;
      }

      /* Table view hierarchy styling */
      .parent-info-table {
        display: flex;
        align-items: center;
        gap: 3px;
        margin-top: 2px;
      }

      /* Table row styling for hierarchy */
      #tableView tr:has(.parent-info-table) {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      }

      #tableView tr:has(.parent-info-table) td:first-child {
        border-left: 3px solid #cbd5e1;
      }

      #tableView tr:not(:has(.parent-info-table)) td:first-child {
        border-left: 3px solid #4361ee;
      }

      /* Table view action buttons alignment */
      #tableView .action-buttons {
        display: flex;
        gap: 6px;
        align-items: center;
        justify-content: center;
      }

      #tableView .action-btn {
        width: 32px;
        height: 32px;
        font-size: 12px;
      }

      /* Fix action buttons alignment */
      .category-admin-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
      }

      .category-admin-actions {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-shrink: 0;
      }

      .action-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        font-size: 14px;
      }

      .action-btn.view {
        background: #e0f2fe;
        color: #0369a1;
      }

      .action-btn.view:hover {
        background: #bae6fd;
      }

      .action-btn.edit {
        background: #fef3c7;
        color: #d97706;
      }

      .action-btn.edit:hover {
        background: #fde68a;
      }

      .action-btn.delete {
        background: #fee2e2;
        color: #dc2626;
      }

      .action-btn.delete:hover {
        background: #fecaca;
      }

      .action-btn.success {
        background: #d1fae5;
        color: #16a34a;
      }

      .action-btn.success:hover {
        background: #a7f3d0;
      }

      .action-btn.danger {
        background: #fee2e2;
        color: #dc2626;
      }

      .action-btn.danger:hover {
        background: #fecaca;
      }

      /* Checkbox alignment */
      .checkbox-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
      }

      /* Custom Confirm Modal */
      .custom-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        max-width: 400px;
        width: 90%;
        position: relative;
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .modal-header {
        padding: 20px 24px 0;
      }

      .modal-header h3 {
        margin: 0;
        font-size: 1.2rem;
        font-weight: 600;
        color: #1f2937;
      }

      .modal-body {
        padding: 16px 24px 24px;
      }

      .modal-body p {
        margin: 0;
        color: #6b7280;
        line-height: 1.5;
      }

      .modal-footer {
        padding: 0 24px 24px;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }

      .modal-btn {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 80px;
      }

      .cancel-btn {
        background: #f3f4f6;
        color: #6b7280;
      }

      .cancel-btn:hover {
        background: #e5e7eb;
      }

      .confirm-btn {
        background: #3b82f6;
        color: white;
      }

      .confirm-btn:hover {
        background: #2563eb;
      }

      .confirm-btn.danger {
        background: #ef4444;
      }

      .confirm-btn.danger:hover {
        background: #dc2626;
      }
    </style>
  </head>
  <body class="admin-body">
    <header class="admin-header">
      <div class="admin-header-content">
        <div class="admin-logo">
          <a th:href="@{/admin/index}" class="logo">
            <div class="logo-icon">E</div>
            <div class="logo-text">EduShare</div>
          </a>
        </div>
        <div class="admin-header-actions">
          <div class="admin-search">
            <input
              type="text"
              placeholder="Tìm kiếm..."
              class="search-input"
              id="headerSearchInput"
            />
            <button id="headerSearchBtn"><i class="fas fa-search"></i></button>
          </div>
          <div class="dark-mode-toggle" id="darkModeToggle"></div>
          <div class="admin-notifications">
            <button class="notification-btn">
              <i class="fas fa-bell"></i>
              <span class="notification-badge">5</span>
            </button>
          </div>
          <div class="admin-profile">
            <div class="admin-avatar">
              <img
                src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                alt="Admin"
              />
            </div>
            <div class="admin-info">
              <span class="admin-name">Nguyễn Văn Anh</span>
              <span class="admin-role">Quản trị viên</span>
            </div>
            <div class="admin-dropdown">
              <i class="fas fa-chevron-down"></i>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="admin-container">
      <aside class="admin-sidebar">
        <nav class="admin-nav">
          <ul class="admin-menu">
            <li class="admin-menu-item">
              <a th:href="@{/admin/index}"
                ><i class="fas fa-tachometer-alt"></i
                ><span>Bảng điều khiển</span></a
              >
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/admin/users}"
                ><i class="fas fa-users"></i><span>Quản lý người dùng</span></a
              >
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/admin/documents}"
                ><i class="fas fa-file-alt"></i><span>Quản lý tài liệu</span></a
              >
            </li>
            <li class="admin-menu-item active">
              <a th:href="@{/admin/categories}"
                ><i class="fas fa-folder"></i><span>Quản lý danh mục</span></a
              >
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/admin/tags}"
                ><i class="fas fa-tags"></i><span>Quản lý tags</span></a
              >
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/admin/comments}"
                ><i class="fas fa-comments"></i
                ><span>Quản lý bình luận</span></a
              >
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/admin/reports}"
                ><i class="fas fa-flag"></i><span>Báo cáo vi phạm</span></a
              >
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/admin/ip-bans}"
                ><i class="fas fa-ban"></i><span>IP bị cấm</span></a
              >
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/admin/statistics}"
                ><i class="fas fa-chart-bar"></i><span>Thống kê</span></a
              >
            </li>
            <li class="admin-menu-item has-submenu">
              <a href="javascript:void(0)">
                <i class="fas fa-coins"></i>
                <span>Quản lý doanh thu</span>
                <i class="fas fa-chevron-down submenu-icon"></i>
              </a>
              <ul class="submenu">
                <li class="submenu-item">
                  <a th:href="@{/admin/coin-packages}"
                    ><i class="fas fa-box"></i><span>Gói xu</span></a
                  >
                </li>
                <li class="submenu-item">
                  <a th:href="@{/admin/transactions}"
                    ><i class="fas fa-exchange-alt"></i
                    ><span>Giao dịch</span></a
                  >
                </li>
                <li class="submenu-item">
                  <a th:href="@{/admin/withdrawals}"
                    ><i class="fas fa-money-bill-wave"></i
                    ><span>Yêu cầu rút tiền</span></a
                  >
                </li>
              </ul>
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/admin/settings}"
                ><i class="fas fa-cog"></i><span>Cài đặt</span></a
              >
            </li>
            <li class="admin-menu-item">
              <a th:href="@{/logout}"
                ><i class="fas fa-sign-out-alt"></i><span>Đăng xuất</span></a
              >
            </li>
          </ul>
        </nav>
      </aside>

      <main class="admin-content">
        <div class="admin-content-header">
          <h1 class="admin-page-title">Quản lý danh mục</h1>

          <div class="admin-breadcrumbs">
            <a th:href="@{/admin/index}">Admin</a>
            <span>/</span>
            <span>Quản lý danh mục</span>
          </div>
        </div>

        <!-- Success/Error Messages -->
        <div th:if="${success}" class="alert alert-success success-message">
          <i class="fas fa-check-circle"></i>
          <span th:text="${success}"></span>
        </div>
        <div th:if="${error}" class="alert alert-danger error-message">
          <i class="fas fa-exclamation-triangle"></i>
          <span th:text="${error}"></span>
        </div>

        <!-- Category Tabs -->
        <div class="category-tabs">
          <a
            th:href="@{/admin/categories(tab='active')}"
            th:class="${tab == 'active' ? 'tab-item active' : 'tab-item'}"
          >
            <i class="fas fa-folder"></i>
            <span>Hoạt động</span>
            <span class="tab-count" th:text="${activeCount}">0</span>
          </a>
          <a
            th:href="@{/admin/categories(tab='deleted')}"
            th:class="${tab == 'deleted' ? 'tab-item active' : 'tab-item'}"
          >
            <i class="fas fa-trash"></i>
            <span>Đã xóa</span>
            <span class="tab-count" th:text="${deletedCount}">0</span>
          </a>
          <a
            th:href="@{/admin/categories(tab='all')}"
            th:class="${tab == 'all' ? 'tab-item active' : 'tab-item'}"
          >
            <i class="fas fa-list"></i>
            <span>Tất cả</span>
            <span class="tab-count" th:text="${totalCount}">0</span>
          </a>
        </div>

        <div class="management-tools">
          <form id="filterForm" th:action="@{/admin/categories}" method="get">
            <input type="hidden" name="tab" th:value="${tab}" />
            <div class="search-filters">
              <div class="tool-item">
                <input
                  type="text"
                  name="filter"
                  placeholder="Tìm kiếm danh mục..."
                  class="search-input"
                  id="searchInput"
                  th:value="${filter}"
                />
              </div>
              <!-- Chỉ hiển thị filter trạng thái ở tab "Tất cả" -->
              <div class="tool-item" th:if="${tab == 'all'}">
                <select
                  class="filter-select"
                  id="statusFilter"
                  name="status"
                  onchange="this.form.submit()"
                >
                  <option value="all" th:selected="${status == 'all'}">
                    Tất cả trạng thái
                  </option>
                  <option value="active" th:selected="${status == 'active'}">
                    Hoạt động
                  </option>
                  <option
                    value="inactive"
                    th:selected="${status == 'inactive'}"
                  >
                    Vô hiệu hóa
                  </option>
                </select>
              </div>
              <div class="tool-item">
                <select
                  class="filter-select"
                  id="sortFilter"
                  name="sort"
                  onchange="this.form.submit()"
                >
                  <option value="none" th:selected="${sort == 'none'}">
                    Sắp xếp theo
                  </option>
                  <option value="name_asc" th:selected="${sort == 'name_asc'}">
                    Tên (A-Z)
                  </option>
                  <option
                    value="name_desc"
                    th:selected="${sort == 'name_desc'}"
                  >
                    Tên (Z-A)
                  </option>
                  <option
                    value="date_newest"
                    th:selected="${sort == 'date_newest'}"
                  >
                    Ngày tạo (Mới nhất)
                  </option>
                  <option
                    value="date_oldest"
                    th:selected="${sort == 'date_oldest'}"
                  >
                    Ngày tạo (Cũ nhất)
                  </option>
                  <option
                    value="count_most"
                    th:selected="${sort == 'count_most'}"
                  >
                    Số tài liệu (Nhiều nhất)
                  </option>
                  <option
                    value="count_least"
                    th:selected="${sort == 'count_least'}"
                  >
                    Số tài liệu (Ít nhất)
                  </option>
                </select>
              </div>
            </div>
          </form>
          <div class="action-buttons">
            <a
              th:href="@{/admin/categories/create}"
              class="add-new-btn"
              id="addCategoryBtn"
              th:if="${tab != 'deleted'}"
            >
              <i class="fas fa-plus"></i> Thêm danh mục
            </a>
            <button
              type="button"
              class="btn btn-outline"
              id="exportCategoriesBtn"
              style="
                background: transparent;
                color: #4b5563;
                border: 1px solid #d1d5db;
                padding: 8px 16px;
                border-radius: 6px;
                display: inline-flex;
                align-items: center;
                gap: 8px;
              "
            >
              <i class="fas fa-download"></i><span>Export</span>
            </button>
            <button
              id="deleteSelectedBtn"
              class="add-new-btn danger"
              th:if="${tab != 'deleted'}"
            >
              Xóa mục đã chọn
            </button>
            <button
              id="restoreSelectedBtn"
              class="add-new-btn success"
              th:if="${tab == 'deleted'}"
            >
              <i class="fas fa-undo"></i> Khôi phục đã chọn
            </button>
          </div>
        </div>

        <div class="management-view-options">
          <button class="view-option active" data-view="grid">
            <i class="fas fa-th-large"></i> Dạng lưới
          </button>
          <button class="view-option" data-view="table">
            <i class="fas fa-list"></i> Dạng bảng
          </button>
        </div>

        <div class="categories-grid-view" id="gridView">
          <div class="categories-grid">
            <div
              class="category-admin-card"
              th:each="cat : ${categories}"
              th:attr="data-deleted=${cat.deletedAt != null ? 'true' : 'false'}"
            >
              <div class="category-admin-header">
                <div class="checkbox-wrapper">
                  <input
                    type="checkbox"
                    class="category-checkbox"
                    th:attr="data-category-id=${cat.id}"
                    th:id="'cat-checkbox-' + ${cat.id}"
                  />
                  <label th:for="'cat-checkbox-' + ${cat.id}"></label>
                </div>
                <div class="category-admin-actions">
                  <a
                    class="action-btn view"
                    th:href="@{/admin/categories/details/{id}(id=${cat.id})}"
                    title="Xem"
                    ><i class="fas fa-eye"></i
                  ></a>

                  <!-- Actions for active categories -->
                  <div th:if="${cat.deletedAt == null}">
                    <a
                      class="action-btn edit"
                      th:href="@{/admin/categories/edit/{id}(id=${cat.id})}"
                      title="Chỉnh sửa"
                      ><i class="fas fa-edit"></i
                    ></a>
                    <button
                      class="action-btn delete"
                      th:attr="data-category-id=${cat.id}"
                      title="Xóa"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>

                  <!-- Actions for deleted categories -->
                  <div th:if="${cat.deletedAt != null}">
                    <form
                      th:action="@{/admin/categories/{id}/restore(id=${cat.id})}"
                      method="post"
                      style="display: inline"
                    >
                      <button
                        type="submit"
                        class="action-btn success"
                        title="Khôi phục"
                      >
                        <i class="fas fa-undo"></i>
                      </button>
                    </form>
                  </div>
                </div>
              </div>
              <div class="category-admin-content">
                <div class="category-info">
                  <div class="category-icon">
                    <i
                      th:class="${cat.parentId != null ? 'fas fa-folder-open' : 'fas fa-folder'}"
                      th:style="${cat.parentId != null ? 'color: #6c757d;' : 'color: #4361ee;'}"
                    ></i>
                  </div>
                  <div class="category-details">
                    <h4
                      class="category-admin-title"
                      th:text="${cat.name}"
                      th:style="${cat.parentId != null ? 'font-size: 0.9rem; color: #6c757d; font-family: monospace; white-space: pre;' : ''}"
                    ></h4>
                    <!-- Hiển thị thông tin parent nếu là danh mục con -->
                    <div th:if="${cat.parentId != null}" class="parent-info">
                      <i
                        class="fas fa-level-up-alt"
                        style="font-size: 0.7rem; color: #9ca3af"
                      ></i>
                      <span
                        style="font-size: 0.75rem; color: #9ca3af"
                        th:text="'Danh mục con của ' + ${cat.parentName}"
                        >Danh mục con của ABC</span
                      >
                    </div>
                  </div>
                </div>
                <div class="category-stats">
                  <div class="stat-item">
                    <span class="stat-label">Tài liệu</span>
                    <span class="stat-value" th:text="${cat.documents}"></span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Mục con</span>
                    <span
                      class="stat-value"
                      th:text="${cat.subcategories}"
                    ></span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Ngày tạo</span>
                    <span
                      class="stat-value"
                      th:text="${cat.hierarchyCreatedAt != null} ? ${#temporals.format(cat.hierarchyCreatedAt, 'dd/MM/yyyy')} : ${#temporals.format(cat.createdAt, 'dd/MM/yyyy')}"
                    ></span>
                  </div>
                </div>
                <div class="category-admin-status">
                  <span
                    th:class="'status-badge ' + ${cat.status == 'active' ? 'badge-success' : 'badge-danger'}"
                    th:text="${cat.status == 'active' ? 'Hoạt động' : 'Vô hiệu hóa'}"
                  ></span>
                </div>
              </div>
            </div>
            <div th:if="${categories.isEmpty()}" class="empty-state">
              <div class="empty-icon"><i class="fas fa-folder"></i></div>
              <h3>Không có danh mục nào</h3>
              <p>Không tìm thấy danh mục nào phù hợp với bộ lọc hiện tại.</p>
              <a th:href="@{/admin/categories/create}" class="add-new-btn"
                >Tạo danh mục đầu tiên</a
              >
            </div>
          </div>
        </div>

        <div class="data-container" id="tableView" style="display: none">
          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>
                    <div class="checkbox-wrapper">
                      <input type="checkbox" id="selectAll" />
                      <label for="selectAll"></label>
                    </div>
                  </th>
                  <th>Danh mục</th>
                  <th>
                    Số tài liệu
                  </th>
                  <th>
                    Danh mục con
                  </th>
                  <th>
                    Ngày tạo
                  </th>
                  <th>
                    Trạng thái
                  </th>
                  <th>Thao tác</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="cat : ${categories}">
                  <td>
                    <div class="checkbox-wrapper">
                      <input
                        type="checkbox"
                        class="category-checkbox"
                        th:attr="data-category-id=${cat.id}"
                        th:id="'cat-checkbox-table-' + ${cat.id}"
                      />
                      <label th:for="'cat-checkbox-table-' + ${cat.id}"></label>
                    </div>
                  </td>
                  <td>
                    <div class="category-info">
                      <div class="category-icon">
                        <i
                          th:class="${cat.parentId != null ? 'fas fa-folder-open' : 'fas fa-folder'}"
                          th:style="${cat.parentId != null ? 'color: #6c757d;' : 'color: #4361ee;'}"
                        ></i>
                      </div>
                      <div class="category-details">
                        <h4
                          class="category-name"
                          th:text="${cat.name}"
                          th:style="${cat.parentId != null ? 'font-size: 0.85rem; color: #6c757d; font-family: monospace; white-space: pre;' : 'font-weight: 600; color: #1e293b;'}"
                        ></h4>
                        <!-- Parent info for table view -->
                        <div
                          th:if="${cat.parentId != null}"
                          class="parent-info-table"
                        >
                          <i
                            class="fas fa-level-up-alt"
                            style="font-size: 0.6rem; color: #9ca3af"
                          ></i>
                          <span
                            style="font-size: 0.7rem; color: #9ca3af"
                            th:text="'Danh mục con của ' + ${cat.parentName}"
                            >Danh mục con của ABC</span
                          >
                        </div>
                      </div>
                    </div>
                  </td>
                  <td th:text="${cat.documents}"></td>
                  <td>
                    <div class="stat-item">
                      <i class="fas fa-sitemap"></i>
                      <span th:text="${cat.subcategories}"></span>
                    </div>
                  </td>
                  <td>
                    <div class="stat-item">
                      <i class="fas fa-calendar-alt"></i>
                      <span
                        th:text="${cat.hierarchyCreatedAt != null} ? ${#temporals.format(cat.hierarchyCreatedAt, 'dd/MM/yyyy')} : ${#temporals.format(cat.createdAt, 'dd/MM/yyyy')}"
                      ></span>
                    </div>
                  </td>
                  <td>
                    <span
                      th:class="'status-badge ' + ${cat.status == 'active' ? 'badge-success' : 'badge-danger'}"
                      th:text="${cat.status == 'active' ? 'Hoạt động' : 'Vô hiệu hóa'}"
                    ></span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <a
                        class="action-btn view"
                        th:href="@{/admin/categories/details/{id}(id=${cat.id})}"
                        title="Xem"
                        ><i class="fas fa-eye"></i
                      ></a>

                      <!-- Actions for active categories -->
                      <div
                        th:if="${cat.deletedAt == null}"
                        style="display: inline"
                      >
                        <a
                          class="action-btn edit"
                          th:href="@{/admin/categories/edit/{id}(id=${cat.id})}"
                          title="Chỉnh sửa"
                          ><i class="fas fa-edit"></i
                        ></a>
                        <button
                          class="action-btn delete"
                          th:attr="data-category-id=${cat.id}"
                          title="Xóa"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>

                      <!-- Actions for deleted categories -->
                      <div
                        th:if="${cat.deletedAt != null}"
                        style="display: inline"
                      >
                        <form
                          th:action="@{/admin/categories/{id}/restore(id=${cat.id})}"
                          method="post"
                          style="display: inline"
                        >
                          <button
                            type="submit"
                            class="action-btn success"
                            title="Khôi phục"
                          >
                            <i class="fas fa-undo"></i>
                          </button>
                        </form>
                      </div>
                    </div>
                  </td>
                </tr>
                <tr th:if="${categories.isEmpty()}">
                  <td colspan="7">Không có danh mục nào.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="pagination" th:if="${totalPages > 0}">
          <a
            th:if="${currentPage > 1}"
            th:href="@{/admin/categories(page=${currentPage - 1}, size=${pageSize}, filter=${filter != null ? filter : ''}, status=${status != null ? status : 'all'}, sort=${sort != null ? sort : 'none'}, tab=${tab != null ? tab : 'active'})}"
            class="pagination-btn prev-btn"
          >
            <i class="fas fa-chevron-left"></i>
          </a>
          <a
            th:if="${currentPage == 1}"
            class="pagination-btn prev-btn disabled"
          >
            <i class="fas fa-chevron-left"></i>
          </a>
          <div class="pagination-pages">
            <!-- Trang đầu -->
            <a
              th:if="${currentPage > 3}"
              th:href="@{/admin/categories(page=1, size=${pageSize}, filter=${filter != null ? filter : ''}, status=${status != null ? status : 'all'}, sort=${sort != null ? sort : 'none'}, tab=${tab != null ? tab : 'active'})}"
              class="pagination-btn page-btn"
              >1</a
            >
            <span th:if="${currentPage > 4}" class="pagination-ellipsis"
              >...</span
            >

            <!-- Các trang gần currentPage -->
            <a
              th:each="i : ${#numbers.sequence(currentPage - 2 > 1 ? currentPage - 2 : 1, currentPage + 2 < totalPages ? currentPage + 2 : totalPages)}"
              th:href="@{/admin/categories(page=${i}, size=${pageSize}, filter=${filter != null ? filter : ''}, status=${status != null ? status : 'all'}, sort=${sort != null ? sort : 'none'}, tab=${tab != null ? tab : 'active'})}"
              th:class="${i == currentPage ? 'pagination-btn page-btn active' : 'pagination-btn page-btn'}"
              th:text="${i}"
            ></a>

            <!-- Dấu ... và trang cuối -->
            <span
              th:if="${currentPage < totalPages - 3}"
              class="pagination-ellipsis"
              >...</span
            >
            <a
              th:if="${currentPage < totalPages - 2}"
              th:href="@{/admin/categories(page=${totalPages}, size=${pageSize}, filter=${filter != null ? filter : ''}, status=${status != null ? status : 'all'}, sort=${sort != null ? sort : 'none'}, tab=${tab != null ? tab : 'active'})}"
              class="pagination-btn page-btn"
              th:text="${totalPages}"
            ></a>
          </div>
          <a
            th:if="${currentPage < totalPages}"
            th:href="@{/admin/categories(page=${currentPage + 1}, size=${pageSize}, filter=${filter != null ? filter : ''}, status=${status != null ? status : 'all'}, sort=${sort != null ? sort : 'none'}, tab=${tab != null ? tab : 'active'})}"
            class="pagination-btn next-btn"
          >
            <i class="fas fa-chevron-right"></i>
          </a>
          <a
            th:if="${currentPage == totalPages}"
            class="pagination-btn next-btn disabled"
          >
            <i class="fas fa-chevron-right"></i>
          </a>
        </div>

        <!-- Confirm Delete Modal -->
        <div class="modal" id="confirmDeleteModal">
          <div class="modal-overlay" data-modal-close></div>
          <div class="modal-container">
            <div class="modal-header">
              <h3>Xác nhận xóa</h3>
              <button class="modal-close" data-modal-close>
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body">
              <div class="confirm-delete-content">
                <div class="confirm-icon">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p>Bạn có chắc chắn muốn xóa danh mục này không?</p>
                <p class="text-muted">Hành động này không thể hoàn tác.</p>
              </div>
            </div>
            <div class="modal-footer">
              <button class="cancel-btn" data-modal-close>Hủy</button>
              <button class="add-new-btn danger" id="confirmDeleteBtn">
                Xóa
              </button>
            </div>
          </div>
        </div>

        <!-- Bulk Action Modal -->
        <div class="modal" id="bulkActionModal">
          <div class="modal-overlay" data-modal-close></div>
          <div class="modal-container">
            <div class="modal-header">
              <h3 id="bulkActionTitle">Xác nhận thao tác</h3>
              <button class="modal-close" data-modal-close>
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body">
              <div class="bulk-action-content">
                <p id="bulkActionMessage">
                  Bạn có chắc chắn muốn thực hiện thao tác này?
                </p>
                <div class="bulk-action-details">
                  <strong
                    >Số danh mục được chọn:
                    <span id="bulkActionCount">0</span></strong
                  >
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="cancel-btn" data-modal-close>Hủy</button>
              <button class="save-btn" id="confirmBulkActionBtn">
                Thực hiện
              </button>
            </div>
          </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Custom Confirm Modal -->
        <div class="custom-modal" id="confirmModal" style="display: none">
          <div class="modal-overlay"></div>
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="confirmTitle">Xác nhận</h3>
            </div>
            <div class="modal-body">
              <p id="confirmMessage">
                Bạn có chắc chắn muốn thực hiện hành động này?
              </p>
            </div>
            <div class="modal-footer">
              <button class="modal-btn cancel-btn" id="confirmCancel">
                Hủy
              </button>
              <button class="modal-btn confirm-btn" id="confirmOk">OK</button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
    <script th:src="@{/js/main.js}"></script>
    <script th:src="@{/js/admin/admin.js}"></script>
    <script th:src="@{/js/admin/notifications.js}"></script>
    <script th:src="@{/js/admin/categories.js}"></script>
  </body>
</html>
