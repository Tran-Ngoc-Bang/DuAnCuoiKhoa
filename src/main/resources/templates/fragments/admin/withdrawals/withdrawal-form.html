<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
  </head>
  <body>
    <!-- Withdrawal Form Fields Fragment -->
    <div
      th:fragment="withdrawal-form-fields(transaction, users, statusOptions, paymentMethods)"
      class="form-grid"
    >
      <!-- Thông tin cơ bản -->
      <div class="form-group full-width">
        <h3><i class="fas fa-info-circle"></i> Thông tin cơ bản</h3>
      </div>

      <!-- Mã withdrawal -->
      <div class="form-group">
        <label for="code">Mã withdrawal</label>
        <div class="code-input-group">
          <input
            type="text"
            id="code"
            name="code"
            th:field="*{code}"
            placeholder="Tự động tạo nếu để trống"
            readonly
          />
          <button
            type="button"
            class="generate-code-btn"
            onclick="generateWithdrawalCode()"
          >
            <i class="fas fa-sync-alt"></i> Tạo mã
          </button>
        </div>
        <span
          th:if="${#fields.hasErrors('code')}"
          class="error-message"
          th:errors="*{code}"
        ></span>
      </div>

      <!-- Người dùng -->
      <div class="form-group">
        <label for="userId">Người dùng *</label>
        <select id="userId" name="user.id" required>
          <option value="">-- Chọn người dùng --</option>
          <option
            th:each="user : ${users}"
            th:value="${user.id}"
            th:text="${user.fullName + ' (' + user.email + ')' + ' - Số xu: ' + #numbers.formatDecimal(user.coinBalance, 0, 'COMMA', 0, 'POINT') + ' xu'}"
            th:selected="${transaction.user != null && transaction.user.id == user.id}"
          >
            Nguyễn Văn A (user@example.com) - Số dư: 1,000,000 VND
          </option>
        </select>
        <span
          th:if="${#fields.hasErrors('user')}"
          class="error-message"
          th:errors="*{user}"
        ></span>
      </div>

      <!-- Số tiền -->
      <div class="form-group">
        <label for="amount">Số tiền (VNĐ) *</label>
        <input
          type="number"
          id="amount"
          name="amount"
          th:field="*{amount}"
          placeholder="Nhập số tiền rút"
          step="1000"
          min="50000"
          max="50000000"
          required
        />
        <small class="form-help"
          >Tối thiểu: 50,000 VND - Tối đa: 50,000,000 VND</small
        >
        <span
          th:if="${#fields.hasErrors('amount')}"
          class="error-message"
          th:errors="*{amount}"
        ></span>
      </div>

      <!-- Phương thức thanh toán -->
      <div class="form-group">
        <label for="paymentMethod">Phương thức thanh toán *</label>
        <select
          id="paymentMethod"
          name="paymentMethod"
          th:field="*{paymentMethod}"
          required
        >
          <option value="">-- Chọn phương thức --</option>
          <option
            th:each="method : ${paymentMethods}"
            th:value="${method.key}"
            th:text="${method.value}"
            th:selected="${transaction.paymentMethod == method.key}"
          >
            Chuyển khoản ngân hàng
          </option>
        </select>
        <span
          th:if="${#fields.hasErrors('paymentMethod')}"
          class="error-message"
          th:errors="*{paymentMethod}"
        ></span>
      </div>

      <!-- Trạng thái -->
      <div class="form-group">
        <label for="status">Trạng thái *</label>
        <select id="status" name="status" th:field="*{status}" required>
          <option value="">-- Chọn trạng thái --</option>
          <option
            th:each="statusOption : ${statusOptions}"
            th:value="${statusOption}"
            th:text="${statusOption.displayName}"
            th:selected="${transaction.status == statusOption}"
          >
            Chờ xử lý
          </option>
        </select>
        <span
          th:if="${#fields.hasErrors('status')}"
          class="error-message"
          th:errors="*{status}"
        ></span>
      </div>

      <!-- Ngày tạo -->
      <div class="form-group">
        <label for="createdAt">Ngày tạo *</label>
        <input
          type="datetime-local"
          id="createdAt"
          name="createdAt"
          th:field="*{createdAt}"
          required
        />
        <span
          th:if="${#fields.hasErrors('createdAt')}"
          class="error-message"
          th:errors="*{createdAt}"
        ></span>
      </div>

      <!-- Ghi chú -->
      <div class="form-group full-width">
        <label for="notes">Ghi chú</label>
        <textarea
          id="notes"
          name="notes"
          th:field="*{notes}"
          rows="3"
          placeholder="Nhập ghi chú bổ sung về withdrawal này..."
        ></textarea>
        <span
          th:if="${#fields.hasErrors('notes')}"
          class="error-message"
          th:errors="*{notes}"
        ></span>
      </div>
    </div>

    <!-- Form Actions Fragment -->
    <div th:fragment="withdrawal-form-actions(backUrl)" class="form-actions">
      <a th:href="${backUrl}" class="secondary-btn">
        <i class="fas fa-arrow-left"></i> Quay lại
      </a>
      <button
        type="button"
        class="secondary-btn"
        onclick="resetWithdrawalForm()"
      >
        <i class="fas fa-undo"></i> Làm mới
      </button>
      <button type="submit" class="primary-btn">
        <i class="fas fa-save"></i> Tạo withdrawal
      </button>
    </div>
  </body>
</html>
