<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:replace="~{::title}">Admin - EduShare</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/admin/notifications.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin/toast.css}"/>
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/admin.css}" />
    <link rel="stylesheet" th:href="@{/css/toast.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/admin_users.css}" />
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <div th:replace="~{fragments/admin/flash-toast :: meta-tags}"></div>
    <th:block th:replace="~{::head}"></th:block>
  </head>
  <body class="admin-body">
    <!-- Admin Header -->
    <header th:fragment="header" class="admin-header">
      <div class="admin-header-content">
        <div class="admin-logo">
          <a th:href="@{/admin}" class="logo">
            <div class="logo-icon">E</div>
            <div class="logo-text">EduShare</div>
          </a>
        </div>
        <div class="admin-header-actions">
          <div class="admin-search">
            <input type="text" placeholder="Tìm kiếm..." />
            <button><i class="fas fa-search"></i></button>
          </div>
          <div class="dark-mode-toggle" id="darkModeToggle"></div>
          <div class="admin-notifications">
            <button
              type="button"
              class="notification-btn"
              id="notificationBtn"
              onclick="toggleNotificationDropdown()"
            >
              <i class="fas fa-bell"></i>
              <span
                class="notification-badge"
                id="notificationBadge"
                th:if="${unreadCount != null and unreadCount > 0}"
                th:text="${unreadCount}"
              ></span>
            </button>

            <!-- Notification Dropdown -->
            <div class="notification-dropdown" id="notificationDropdown">
              <div class="notification-header">
                <h3>Thông báo</h3>
                <button class="mark-all-read" onclick="markAllAsRead()">
                  Đánh dấu đã đọc
                </button>
              </div>

              <div class="notification-list" id="notificationList">
                <!-- Notifications will be loaded from model -->
                <div
                  th:if="${notifications != null and !#lists.isEmpty(notifications)}"
                >
                  <div
                    th:each="notification : ${notifications}"
                    th:class="'notification-item' + (${!notification.isRead} ? ' unread' : '')"
                    th:attr="data-id=${notification.id}"
                  >
                    <div th:class="'notification-icon ' + ${notification.type}">
                      <i th:switch="${notification.type}">
                        <i th:case="'document'" class="fas fa-upload"></i>
                        <i th:case="'register'" class="fas fa-user-plus"></i>
                        <i th:case="'report'" class="fas fa-flag"></i>
                        <i
                          th:case="'payment'"
                          class="fas fa-money-bill-wave"
                        ></i>
                        <i th:case="'comment'" class="fas fa-comment"></i>
                        <i th:case="*" class="fas fa-bell"></i>
                      </i>
                    </div>
                    <div class="notification-content">
                      <div
                        class="notification-text"
                        th:text="${notification.message}"
                      ></div>
                      <div class="notification-time">
                        <i class="far fa-clock"></i>
                        <span
                          th:text="${#temporals.format(notification.createdAt, 'dd/MM/yyyy HH:mm')}"
                        ></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  th:if="${notifications == null or #lists.isEmpty(notifications)}"
                  class="notification-empty"
                >
                  <i class="fas fa-bell-slash"></i>
                  <p>Không có thông báo nào</p>
                </div>
              </div>

              <div class="notification-footer">
                <a href="/admin/notifications">Xem tất cả thông báo</a>
              </div>
            </div>
          </div>
          <div class="admin-profile">
            <div class="admin-avatar">
              <img
                src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                alt="Admin"
              />
            </div>
            <div class="admin-info">
              <span class="admin-name">Nguyễn Văn A</span>
              <span class="admin-role">Quản trị viên</span>
            </div>
            <div class="admin-dropdown">
              <i class="fas fa-chevron-down"></i>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="admin-container">
      <!-- Sidebar -->
      <aside class="admin-sidebar">
        <nav class="admin-nav">
          <ul class="admin-menu">
            <li class="admin-menu-item">
              <a href="/admin/index.html">
                <i class="fas fa-tachometer-alt"></i>
                <span>Bảng điều khiển</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/users.html">
                <i class="fas fa-users"></i>
                <span>Quản lý người dùng</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/documents.html">
                <i class="fas fa-file-alt"></i>
                <span>Quản lý tài liệu</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/categories.html">
                <i class="fas fa-folder"></i>
                <span>Quản lý danh mục</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/tags.html">
                <i class="fas fa-tags"></i>
                <span>Quản lý tags</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/comments.html">
                <i class="fas fa-comments"></i>
                <span>Quản lý bình luận</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/reports.html">
                <i class="fas fa-flag"></i>
                <span>Báo cáo vi phạm</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/ip-bans.html">
                <i class="fas fa-ban"></i>
                <span>IP bị cấm</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/statistics.html">
                <i class="fas fa-chart-bar"></i>
                <span>Thống kê</span>
              </a>
            </li>
            <li class="admin-menu-item has-submenu">
              <a href="javascript:void(0)" class="submenu-toggle">
                <i class="fas fa-coins"></i>
                <span>Quản lý doanh thu</span>
                <i class="fas fa-chevron-down submenu-icon"></i>
              </a>
              <ul class="admin-submenu">
                <li class="submenu-item">
                  <a th:href="@{/admin/coin-packages}">
                    <i class="fas fa-coins"></i>
                    <span>Quản lý gói xu</span>
                  </a>
                </li>
                <li class="submenu-item">
                  <a href="/admin/transactions.html">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Giao dịch</span>
                  </a>
                </li>
                <li class="submenu-item">
                  <a href="/admin/withdrawals.html">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Yêu cầu rút tiền</span>
                  </a>
                </li>
              </ul>
            </li>
            <li class="admin-menu-item">
              <a href="/admin/settings.html">
                <i class="fas fa-cog"></i>
                <span>Cài đặt</span>
              </a>
            </li>
            <li class="admin-menu-item">
              <a href="/index.html">
                <i class="fas fa-sign-out-alt"></i>
                <span>Đăng xuất</span>
              </a>
            </li>
          </ul>
        </nav>
      </aside>
      <!-- Main Content -->
      <main class="admin-content">
        <th:block th:replace="~{::section}"></th:block>
      </main>
    </div>

    <!-- Scripts Fragment -->
    <div th:fragment="scripts">
      <script
        th:src="@{/js/admin/admin.js(v=${#dates.format(#dates.createNow(), 'yyyyMMddHHmmss')})}"
      ></script>
      <!-- Flash Toast Scripts -->
      <div th:replace="~{fragments/admin/flash-toast :: scripts}"></div>
      <script th:src="@{/js/admin/notifications.js}"></script>
    </div>
  </body>
</html>
<style>
  .notification-dropdown.show {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) !important;
  }
</style>
<!-- Notification JavaScript -->
<script th:src="@{/js/admin/notifications.js}"></script>

<style>
  .notification-dropdown.show {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) !important;
  }
</style>
