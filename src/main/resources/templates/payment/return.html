<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kết quả thanh toán - EduShare</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .payment-result {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .result-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        padding: 40px;
        text-align: center;
        max-width: 500px;
        width: 100%;
      }
      .result-icon {
        font-size: 80px;
        margin-bottom: 20px;
      }
      .success-icon {
        color: #28a745;
      }
      .error-icon {
        color: #dc3545;
      }
      .pending-icon {
        color: #ffc107;
      }
      .result-title {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 15px;
      }
      .result-message {
        font-size: 16px;
        color: #6c757d;
        margin-bottom: 30px;
        line-height: 1.6;
      }
      .transaction-details {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        text-align: left;
      }
      .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 5px 0;
        border-bottom: 1px solid #e9ecef;
      }
      .detail-row:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }
      .detail-label {
        font-weight: 600;
        color: #495057;
      }
      .detail-value {
        color: #6c757d;
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }
      .btn-secondary {
        background: #6c757d;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body>
    <div class="payment-result">
      <div class="result-card">
        <!-- Success Result -->
        <div th:if="${success == true}">
          <i class="fas fa-check-circle result-icon success-icon"></i>
          <h1 class="result-title text-success">Thanh toán thành công!</h1>
          <p class="result-message">
            Giao dịch của bạn đã được xử lý thành công. Xu đã được cộng vào tài
            khoản của bạn.
          </p>
        </div>

        <!-- Error Result -->
        <div th:if="${success == false}">
          <i class="fas fa-times-circle result-icon error-icon"></i>
          <h1 class="result-title text-danger">Thanh toán thất bại!</h1>
          <p class="result-message">
            <span th:text="${message}"
              >Có lỗi xảy ra trong quá trình thanh toán.</span
            >
          </p>
        </div>

        <!-- Pending Result -->
        <div th:if="${success == null}">
          <i class="fas fa-clock result-icon pending-icon"></i>
          <h1 class="result-title text-warning">Đang xử lý...</h1>
          <p class="result-message">
            Giao dịch của bạn đang được xử lý. Vui lòng chờ trong giây lát.
          </p>
        </div>

        <!-- Transaction Details -->
        <div class="transaction-details" th:if="${transactionCode != null}">
          <h5 class="mb-3">
            <i class="fas fa-info-circle"></i> Chi tiết giao dịch
          </h5>
          <div class="detail-row">
            <span class="detail-label">Mã giao dịch:</span>
            <span class="detail-value" th:text="${transactionCode}">-</span>
          </div>
          <div class="detail-row" th:if="${amount != null}">
            <span class="detail-label">Số tiền:</span>
            <span
              class="detail-value"
              th:text="${#numbers.formatDecimal(amount, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"
              >-</span
            >
          </div>
          <div class="detail-row" th:if="${errorCode != null}">
            <span class="detail-label">Mã lỗi:</span>
            <span class="detail-value" th:text="${errorCode}">-</span>
          </div>
          <div class="detail-row" th:if="${message != null}">
            <span class="detail-label">Thông báo:</span>
            <span class="detail-value" th:text="${message}">-</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex gap-3 justify-content-center">
          <a href="/account/recharge" class="btn btn-primary">
            <i class="fas fa-plus-circle me-2"></i>Nạp thêm xu
          </a>
          <a href="/account/dashboard" class="btn btn-secondary">
            <i class="fas fa-home me-2"></i>Về trang chủ
          </a>
        </div>

        <!-- Auto redirect info -->
        <div class="mt-4" th:if="${success == true}">
          <small class="text-muted">
            <i class="fas fa-info-circle me-1"></i>
            Bạn sẽ được chuyển về trang tài khoản trong
            <span id="countdown">5</span> giây
          </small>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
      // Auto redirect after successful payment
      const success = /*[[${success}]]*/ false;
      if (success) {
        let countdown = 5;
        const countdownElement = document.getElementById("countdown");
        const timer = setInterval(() => {
          countdown--;
          countdownElement.textContent = countdown;
          if (countdown <= 0) {
            clearInterval(timer);
            window.location.href = "/account/dashboard";
          }
        }, 1000);
      }
    </script>
  </body>
</html>
