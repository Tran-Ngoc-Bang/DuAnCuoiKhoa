<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>Trang Tổng Quan - EduShare</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="stylesheet" th:href="@{/css/main.css}">
  <link rel="stylesheet" th:href="@{/css/responsive.css}">
  <link rel="stylesheet" th:href="@{/css/main-fixes.css}">
  <link rel="stylesheet" th:href="@{/css/account.css}">
  <link rel="stylesheet" th:href="@{/css/footer-modern.css}">
  <link rel="stylesheet" th:href="@{/css/search-modern.css}">
  <link rel="stylesheet" th:href="@{/css/client-header.css}">
  <link rel="stylesheet" th:href="@{/css/client-footer.css}">
  <link rel="stylesheet" th:href="@{/css/client-favorites.css}">
</head>

<body>
  <!-- Header -->
  <div th:replace="~{fragments/client/layout :: header}"></div>
  <main>
    <div class="container dashboard-page">
      <div class="dashboard-content">
        <!-- Sidebar -->
        <div th:replace="~{fragments/client/account-sidebar :: account-sidebar}"></div>

        <!-- Main Content -->
        <div class="dashboard-main">
          <!-- Chart -->
          <div class="dashboard-section" style="position: relative;">

            <div class="section-header">
              <h1 class="section-title">
                <i class="fas fa-bookmark section-title-icon"></i>
                Danh sách tài liệu đã lưu:
              </h1>
              <!-- Search Stats Bar -->

              <div class="search-options">
                <div class="search-layout-options">
                  <button class="layout-option active" data-layout="grid" id="gridBtn" onclick="setGridView()"
                    title="Xem dạng lưới">
                    <i class="fas fa-th-large"></i>
                  </button>
                  <button class="layout-option" data-layout="list" id="listBtn" onclick="setListView()"
                    title="Xem dạng danh sách">
                    <i class="fas fa-list"></i>
                  </button>
                </div>
                <div class="search-sort-options">
                  <span class="sort-label">Sắp xếp:</span>
                  <select id="sortSelect" class="sort-select">
                    <option value="default" selected>Mặc định</option>
                    <option value="price-asc">Giá tăng</option>
                    <option value="price-desc">Giá giảm</option>
                    <option value="rating-desc">Đánh giá cao nhất</option>
                  </select>
                </div>
              </div>

            </div>
            <div class="doc-card-container grid-view" id="docContainer">
              <div th:each="favorite : ${favorites}" class="doc-card-item" th:data-doc-id="${favorite.document.id}">
                <div class="doc-card-img-wrapper">
                  <div class="result-badge premium">
                    <i class="fas fa-coins"></i>
                    <span th:text="${favorite.document.price} + ' xu'"></span>
                  </div>
                  <img
                    src="https://images.unsplash.com/photo-1633356122544-f134324a6cee?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                    alt="Tài liệu" class="doc-img-fixed">
                  <div class="doc-card-popup">
                    <p><strong>Mẹo:</strong> Click để xem chi tiết tài liệu!</p>
                  </div>
                </div>

                <div class="doc-card-content">
                  <h3 class="doc-card-title" th:text="${favorite.document.title}">Tiêu đề</h3>
                  <div class="doc-card-meta">
                    <span><i class="fas fa-folder"></i> Công nghệ</span>
                    <span><i class="fas fa-file-pdf"></i> PDF</span>
                    <span><i class="fas fa-user"></i> <span th:text="${favorite.document.slug}">Tác giả</span></span>
                    <span><i class="fas fa-star"></i> 4.8</span>
                  </div>
                  <div class="doc-card-actions">
                    <div>
                      <a th:href="@{/documents/{id}(id=${favorite.document.id})}" class="doc-card-btn">
                        <i class="fas fa-download"></i>
                      </a>
                      <button class="doc-card-btn">
                        <i class="fas fa-bookmark"></i>
                      </button>
                      <button class="doc-card-btn share-btn">
                        <i class="fas fa-share-alt"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div id="pagination" class="pagination-controls">
              <!-- Nút phân trang sẽ được JS tạo ở đây -->
            </div>

          </div>
        </div>
      </div>
  </main>

  <!-- Footer -->
  <div th:replace="~{fragments/client/layout :: footer}"></div>

  <!-- Back To Top Button -->
  <button id="backToTop" class="back-to-top">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script th:src="@{/js/client-header.js}"></script>
  <script th:src="@{/js/main.js}"></script>
  <script th:src="@{/js/account.js}"></script>
  <script th:src="@{/js/popup.js}"></script>
  <script th:src="@{/js/grid_list.js}"></script>
  <script th:src="@{/js/page.js}"></script>
  <script th:src="@{/js/loading.js}"></script>
  <script th:src="@{/js/sort_document.js}"></script>
  <script th:src="@{/js/client-favorites.js}"></script>

  <script>
    const currentPath = window.location.pathname.split('/').pop();

    document.querySelectorAll('.sidebar-menu-link').forEach(link => {
      const linkPath = link.getAttribute('href');
      if (linkPath === currentPath) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });

    function showToast(message = "Liên kết đã được sao chép!") {
      const toast = document.getElementById("docToast");
      toast.textContent = message;
      toast.classList.add("show");

      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000);
    }


    document.querySelectorAll(".share-btn").forEach(button => {
      button.addEventListener("click", function () {
        const docCard = this.closest('.doc-card-item');
        const docId = docCard.getAttribute('data-doc-id');

        if (!docId) {
          console.error("Không tìm thấy ID tài liệu.");
          showToast("Không thể sao chép liên kết", "error");
          return;
        }

        const shareUrl = `http://localhost:8080/documents/${docId}`;

        navigator.clipboard.writeText(shareUrl)
          .then(() => {
            showToast("Đã sao chép link chia sẻ!", "success");
          })
          .catch(err => {
            console.error("Lỗi khi sao chép:", err);
            showToast("Không thể sao chép liên kết", "error");
          });
      });
    });

  </script>

</body>
<div id="docToast" class="doc-popup-toast">Liên kết đã được sao chép!</div>
<div id="sort-toast" class="sort-toast">Sắp xếp: Mặc định</div>

</html>