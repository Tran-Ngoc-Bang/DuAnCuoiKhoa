<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>Tìm kiếm tài liệu - EduShare</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" th:href="@{/css/main.css}">
  <link rel="stylesheet" th:href="@{/css/responsive.css}">
  <link rel="stylesheet" th:href="@{/css/main-fixes.css}">
  <link rel="stylesheet" th:href="@{/css/search.css}">
  <link rel="stylesheet" th:href="@{/css/search-modern.css}">
  <link rel="stylesheet" th:href="@{/css/footer-modern.css}">
  <link rel="stylesheet" th:href="@{/css/client-header.css}">
  <link rel="stylesheet" th:href="@{/css/client-footer.css}">
  <style>
    .filter-options {
      max-height: 250px;
      overflow-y: auto;
      padding-right: 6px;
    }

    .filter-options::-webkit-scrollbar {
      width: 6px;
    }

    .filter-options::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 4px;
    }

    .filter-header.active {
      background-color: #007bff;
    }
  </style>
  <style>
    .pagination {
      margin-top: 20px;
      text-align: center;
    }

    .pagination button {
      margin: 0 5px;
      padding: 6px 12px;
      border: none;
      background-color: #eee;
      cursor: pointer;
      border-radius: 4px;
    }

    .pagination button.active {
      background-color: #007bff;
      color: white;
      font-weight: bold;
    }
  </style>

</head>

<body>
  <!-- Header -->
  <div th:replace="~{fragments/client/layout :: header}"></div>
  <div class="container">
    <div class="header-content">
      <div class="logo">
        <a href="../index.html">
          <div class="logo-icon">E</div>
          <span class="logo-text">EduShare</span>
        </a>
      </div>
      <nav class="main-nav">
        <a href="../index.html" class="nav-link">Trang chủ</a>
        <a href="categories.html" class="nav-link">Danh mục</a>
        <a href="search.html?sort=newest" class="nav-link">Tài liệu mới</a>
        <a href="search.html?filter=premium" class="nav-link">Cao cấp</a>
        <a href="about.html" class="nav-link">Giới thiệu</a>
      </nav>
      <div class="header-actions">
        <!-- Đã xóa ô tìm kiếm theo yêu cầu -->
        <button class="dark-mode-toggle" id="darkModeToggle" type="button" aria-label="Toggle dark mode">
          <span class="dark-mode-handle" id="darkModeHandle"></span>
        </button>
        <a href="login.html" class="login-btn">
          <i class="fas fa-sign-in-alt"></i> Đăng nhập
        </a>
        <a href="register.html" class="register-btn">
          <i class="fas fa-user-plus"></i> Đăng ký
        </a>
      </div>
      <div class="mobile-menu-toggle" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
      </div>
    </div>
  </div>
  <!-- Mobile menu -->
  <div id="mobileMenu" class="mobile-menu">
    <div class="mobile-search">
      <input type="text" placeholder="Tìm kiếm tài liệu...">
      <button>
        <i class="fas fa-search"></i>
      </button>
    </div>
    <nav class="mobile-nav">
      <a href="../index.html" class="mobile-nav-link">Trang chủ</a>
      <a href="categories.html" class="mobile-nav-link">Danh mục</a>
      <a href="search.html?sort=newest" class="mobile-nav-link active">Tài liệu mới</a>
      <a href="search.html?filter=premium" class="mobile-nav-link">Cao cấp</a>
      <a href="#" class="mobile-nav-link">Hướng dẫn</a>
    </nav>
    <div class="mobile-auth">
      <a href="login.html" class="mobile-login-btn">Đăng nhập</a>
      <a href="register.html" class="mobile-register-btn">Đăng ký</a>
    </div>
  </div>
  </header>

  <!-- Main Content -->
  <main>
    <!-- Search Hero Section -->
    <section class="search-hero">
      <div class="container">
        <div class="search-hero-content">
          <h1 class="search-hero-title">Tìm kiếm tài liệu học tập chất lượng cao</h1>
          <p class="search-hero-description">Khám phá hàng nghìn tài liệu từ các lĩnh vực khác nhau - giáo trình, bài
            giảng, đề thi, luận văn và nhiều hơn nữa</p>

          <div class="search-form-container">
            <form id="searchForm" th:action="@{/search}" class="search-form">
              <div class="search-input-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchInput" name="q" class="search-input"
                  placeholder="Tìm kiếm theo tên, tác giả, chủ đề..." autocomplete="off">
              </div>
              <button type="submit" class="search-submit">
                <i class="fas fa-search"></i> Tìm kiếm
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Search Results Section -->
    <section class="search-results-section">
      <div class="container">
        <!-- Search Stats Bar -->
        <div class="search-stats-bar">
          <div class="search-stats-info">
            <div class="search-query-display">
              <span>Kết quả cho:</span> <strong>""</strong>
            </div>
            <!-- <div class="search-count-display">
              <i class="fas fa-file-alt"></i> 215 kết quả
            </div> -->
          </div>

          <div class="search-options">
            <div class="search-layout-options">
              <button class="layout-option active" data-layout="grid">
                <i class="fas fa-th-large"></i>
              </button>
              <button class="layout-option" data-layout="list">
                <i class="fas fa-list"></i>
              </button>
            </div>

            <div class="search-sort-options">
              <span class="sort-label">Sắp xếp:</span>
              <select id="sortSelect" class="sort-select">
                <option value="relevance" selected>Độ liên quan</option>
                <option value="date_desc">Mới nhất</option>
                <option value="rating_desc">Đánh giá cao nhất</option>
                <option value="downloads_desc">Lượt tải nhiều nhất</option>
                <option value="price_asc">Giá thấp đến cao</option>
                <option value="price_desc">Giá cao đến thấp</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Search Content -->
        <div class="search-content">
          <!-- Sidebar Filters -->
          <div class="search-sidebar">
            <button class="mobile-filter-toggle" id="mobileFilterToggle">
              <span>Lọc kết quả</span>
              <i class="fas fa-chevron-down"></i>
            </button>
            <form id="filterForm" method="get" th:action="@{/search}">
              <!-- Category Filter -->
              <div class="filter-section">
                <div class="filter-header">
                  <h3 class="filter-title">Danh mục</h3>
                  <i class="fas fa-chevron-down filter-toggle"></i>
                </div>
                <div class="filter-body">
                  <div class="filter-options">
                    <th:block th:each="cat : ${categories}">
                      <label class="filter-option">
                        <div class="filter-checkbox">
                          <input type="checkbox" name="category" th:value="${cat.slug}"
                            th:checked="${category != null and category.contains(cat.slug)}">
                          <span class="checkmark"></span>
                        </div>
                        <span class="filter-option-label" th:text="${cat.name}">Tên danh mục</span>
                        <span class="filter-option-count" th:text="${categoryCounts[cat.slug]} ?: 0">0</span>
                      </label>
                    </th:block>
                  </div>
                  <button class="show-more-btn">
                    Xem thêm <i class="fas fa-chevron-down"></i>
                  </button>
                </div>
              </div>

              <!-- Format Filter -->
              <div class="filter-section">
                <div class="filter-header">
                  <h3 class="filter-title">Định dạng tệp</h3>
                  <i class="fas fa-chevron-down filter-toggle"></i>
                </div>
                <div class="filter-body">
                  <div class="filter-options">
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="checkbox" name="format" value="pdf">
                        <span class="checkmark"></span>
                      </div>
                      <span class="filter-option-label">PDF</span>
                      <span class="filter-option-count" th:text="${formatCounts['pdf']} ?: 0">0</span>
                    </label>
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="checkbox" name="format" value="doc">
                        <span class="checkmark"></span>
                      </div>
                      <span class="filter-option-label">DOC/DOCX</span>
                      <span class="filter-option-count" th:text="${formatCounts['doc']} ?: 0">0</span>
                    </label>
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="checkbox" name="format" value="ppt">
                        <span class="checkmark"></span>
                      </div>
                      <span class="filter-option-label">PPT/PPTX</span>
                      <span class="filter-option-count" th:text="${formatCounts['ppt']} ?: 0">0</span>
                    </label>
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="checkbox" name="format" value="xls">
                        <span class="checkmark"></span>
                      </div>
                      <span class="filter-option-label">XLS/XLSX</span>
                      <span class="filter-option-count" th:text="${formatCounts['xls']} ?: 0">0</span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Price Filter -->
              <div class="filter-section">
                <div class="filter-header">
                  <h3 class="filter-title">Giá</h3>
                  <i class="fas fa-chevron-down filter-toggle"></i>
                </div>
                <div class="filter-body">
                  <div class="filter-options">
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="checkbox" name="price" value="free"
                          th:checked="${price != null and price.contains('free')}">
                        <span class="checkmark"></span>
                      </div>
                      <span class="filter-option-label">Miễn phí</span>
                      <span class="filter-option-count" th:text="${priceCounts['free']} ?: 0">0</span>
                    </label>

                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="checkbox" name="price" value="paid"
                          th:checked="${price != null and price.contains('paid')}">
                        <span class="checkmark"></span>
                      </div>
                      <span class="filter-option-label">Trả phí</span>
                      <span class="filter-option-count" th:text="${priceCounts['paid']} ?: 0">0</span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Rating Filter -->
              <div class="filter-section">
                <div class="filter-header">
                  <h3 class="filter-title active">Đánh giá</h3>
                  <i class="fas fa-chevron-down filter-toggle"></i>
                </div>
                <div class="filter-body">
                  <div class="filter-options">
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="radio" name="rating" value="4" th:checked="${rating == '4'}" />
                        <span class="radiomark"></span>
                      </div>
                      <span class="filter-option-label">
                        <span class="star-rating">
                          <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                            class="fas fa-star"></i><i class="far fa-star"></i>
                        </span>
                        & trở lên
                      </span>
                      <span class="filter-option-count" th:text="${ratingCounts['4']} ?: 0">0</span>
                    </label>

                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="radio" name="rating" value="3" th:checked="${rating == '3'}" />
                        <span class="radiomark"></span>
                      </div>
                      <span class="filter-option-label">
                        <span class="star-rating">
                          <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                            class="far fa-star"></i><i class="far fa-star"></i>
                        </span>
                        & trở lên
                      </span>
                      <span class="filter-option-count" th:text="${ratingCounts['3']} ?: 0">0</span>
                    </label>

                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="radio" name="rating" value="any"
                          th:checked="${rating == null or rating == 'any'}" />
                        <span class="radiomark"></span>
                      </div>
                      <span class="filter-option-label">Tất cả đánh giá</span>
                      <span class="filter-option-count" th:text="${ratingCounts['any']} ?: 0">0</span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Time Filter -->
              <div class="filter-section">
                <div class="filter-header">
                  <h3 class="filter-title">Thời gian đăng</h3>
                  <i class="fas fa-chevron-down filter-toggle"></i>
                </div>
                <div class="filter-body">
                  <div class="filter-options">
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="radio" name="time" value="week" th:checked="${time == 'week'}">
                        <span class="radiomark"></span>
                      </div>
                      <span class="filter-option-label">7 ngày qua</span>
                      <span class="filter-option-count" th:text="${timeCounts['week']} ?: 0">0</span>
                    </label>
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="radio" name="time" value="month" th:checked="${time == 'month'}">
                        <span class="radiomark"></span>
                      </div>
                      <span class="filter-option-label">30 ngày qua</span>
                      <span class="filter-option-count" th:text="${timeCounts['month']} ?: 0">0</span>
                    </label>
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="radio" name="time" value="year" th:checked="${time == 'year'}">
                        <span class="radiomark"></span>
                      </div>
                      <span class="filter-option-label">1 năm qua</span>
                      <span class="filter-option-count" th:text="${timeCounts['year']} ?: 0">0</span>
                    </label>
                    <label class="filter-option">
                      <div class="filter-checkbox">
                        <input type="radio" name="time" value="any" th:checked="${time == 'any' || time == null}">
                        <span class="radiomark"></span>
                      </div>
                      <span class="filter-option-label">Mọi lúc</span>
                      <span class="filter-option-count" th:text="${timeCounts['any']} ?: 0">0</span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Filter Actions -->
              <div class="filter-actions">
                <button id="applyFilters" class="filter-apply-btn">
                  <i class="fas fa-filter"></i> Áp dụng bộ lọc
                </button>
                <button id="resetFilters" class="filter-reset-btn">
                  <i class="fas fa-undo"></i> Đặt lại bộ lọc
                </button>
              </div>
            </form>
          </div>

          <div class="search-results-container">
            <div id="searchResults" class="search-results grid-view">
              <div th:each="doc : ${searchResults.content}" class="search-result-card" th:attr="data-doc-id=${doc.id}">
                <div class="result-thumbnail">
                  <img
                    src="https://images.unsplash.com/photo-1633356122544-f134324a6cee?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                    alt="Thumbnail">
                  <div class="result-badge premium">
                    <i class="fas fa-coins"></i> <span th:text="${doc.price} + ' xu'">25 xu</span>
                  </div>
                </div>

                <div class="result-content">
                  <div class="result-category">
                    <i class="fas fa-folder"></i>
                    <span th:each="docCat, iterStat : ${doc.documentCategories}">
                      <span th:text="${docCat.category.name}">Công nghệ thông tin</span>
                      <span th:if="${!iterStat.last}">, </span>
                    </span>

                    <span class="result-format pdf">
                      <i class="fas fa-file-pdf"></i> PDF
                    </span>
                  </div>
                  <h3 class="result-title">
                    <a th:href="@{/documents/{id}(id=${doc.id})}" th:text="${doc.title}">
                      Tên tài liệu
                    </a>
                  </h3>

                  <p class="result-description" th:text="${doc.description}">
                    Mô tả ngắn của tài liệu
                  </p>

                  <div class="result-meta">
                    <div class="meta-author">
                      <img
                        src="https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                        alt="Author avatar">
                      <span th:text="${doc.file.uploadedBy.fullName}">Nguyễn Văn A</span>
                    </div>
                    <div class="meta-stats">
                      <div class="stat-item rating">
                        <i class="fas fa-star"></i>
                        <span th:text="${doc.rating}">4.8</span>
                      </div>

                      <div class="stat-item">
                        <i class="fas fa-download"></i> <span th:text="${doc.downloadsCount}">875</span>
                      </div>
                      <div class="stat-item">
                        <i class="fas fa-eye"></i> <span th:text="${doc.viewsCount}">3.2k</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="result-actions">
                  <div class="result-price" th:text="${doc.price + ' xu'}">25 xu</div>
                  <div class="action-buttons">
                    <a th:href="@{/documents/{id}(id=${doc.id})}" class="result-download-btn">
                      <i class="fas fa-download"></i> Tải xuống
                    </a>
                    <button class="result-bookmark-btn">
                      <i
                        th:classappend="${favoriteDocIds.contains(doc.id)} ? 'fas fa-bookmark' : 'far fa-bookmark'"></i>
                    </button>

                  </div>
                </div>
              </div>
            </div>
            <div id="pagination" class="pagination"></div>


          </div>
        </div>
    </section>

    <!-- Related Searches Section -->
    <section class="related-searches">
      <div class="container">
        <h2 class="related-searches-title">Tìm kiếm liên quan</h2>
        <div class="related-searches-list">
          <a th:href="@{/search(q='React Native')}" class="related-search-item">
            <i class="fas fa-search"></i> React Native
          </a>
          <a th:href="@{/search(q='ReactJS Tutorial')}" class="related-search-item">
            <i class="fas fa-search"></i> ReactJS Tutorial
          </a>
          <a th:href="@{/search(q='React Hooks')}" class="related-search-item">
            <i class="fas fa-search"></i> React Hooks
          </a>
          <a th:href="@{/search(q='Redux')}" class="related-search-item">
            <i class="fas fa-search"></i> Redux
          </a>
          <a th:href="@{/search(q='NextJS')}" class="related-search-item">
            <i class="fas fa-search"></i> NextJS
          </a>
          <a th:href="@{/search(q='Frontend Development')}" class="related-search-item">
            <i class="fas fa-search"></i> Frontend Development
          </a>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <div th:replace="~{fragments/client/layout :: footer}"></div>

  <!-- Back To Top Button -->
  <button id="backToTop" class="back-to-top">
    <i class="fas fa-arrow-up"></i>
  </button>

  <script>
    function updateActiveFilterTitles() {
      document.querySelectorAll('.filter-section').forEach(section => {
        const inputs = section.querySelectorAll('input[type="checkbox"], input[type="radio"]');
        const hasChecked = Array.from(inputs).some(input => input.checked);
        const title = section.querySelector('.filter-header');

        if (hasChecked) {
          title.classList.add('active');
        } else {
          title.classList.remove('active');
        }
      });
    }

    window.addEventListener('DOMContentLoaded', updateActiveFilterTitles);

    document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {
      input.addEventListener('change', updateActiveFilterTitles);
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const itemsPerPage = 6;
      const resultContainer = document.getElementById("searchResults");
      const resultCards = Array.from(resultContainer.getElementsByClassName("search-result-card"));
      const paginationContainer = document.getElementById("pagination");

      function showPage(page) {
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;

        resultCards.forEach((card, index) => {
          card.style.display = (index >= start && index < end) ? "block" : "none";
        });

        renderPaginationButtons(page);
      }

      function renderPaginationButtons(currentPage) {
        const totalPages = Math.ceil(resultCards.length / itemsPerPage);
        paginationContainer.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
          const button = document.createElement("button");
          button.innerText = i;
          button.className = (i === currentPage) ? "active" : "";
          button.addEventListener("click", () => showPage(i));
          paginationContainer.appendChild(button);
        }
      }

      // Init pagination
      showPage(1);
    });
  </script>


  <script th:src="@{/js/main.js}"></script>
  <script th:src="@{/js/search.js}"></script>
  <script th:src="@{/js/client-header.js}"></script>
</body>

</html>