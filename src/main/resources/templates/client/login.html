<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng nhập - EduShare</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Open+Sans:wght@400;500;600&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/responsive.css}" />
    <link rel="stylesheet" th:href="@{/css/main-fixes.css}" />
    <link rel="stylesheet" th:href="@{/css/auth.css}" />
    <link rel="stylesheet" th:href="@{/css/footer-modern.css}" />
    <link rel="stylesheet" th:href="@{/css/password-recovery.css}" />
    <link rel="stylesheet" th:href="@{/css/client-header.css}" />
    <link rel="stylesheet" th:href="@{/css/client-footer.css}" />
    <link rel="stylesheet" th:href="@{/css/admin/toast.css}" />
    
    <!-- Flash Toast Meta Tags -->
    <meta name="flash-success" th:content="${success}" th:if="${success}"/>
    <meta name="flash-error" th:content="${error}" th:if="${error}"/>
    <meta name="flash-warning" th:content="${warning}" th:if="${warning}"/>
    <meta name="flash-info" th:content="${info}" th:if="${info}"/>
    
    <style>
      /* Force toast colors to override dark mode and admin styles */
      .toast {
        background: #ffffff !important;
        color: #1f2937 !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
      }
      
      .toast-message {
        color: #1f2937 !important;
      }
      
      .toast-description {
        color: #6b7280 !important;
      }
      
      .toast-close {
        color: #9ca3af !important;
      }
      
      .toast-close:hover {
        color: #6b7280 !important;
        background: #f3f4f6 !important;
      }
      
      /* Override any dark mode media queries */
      @media (prefers-color-scheme: dark) {
        .toast {
          background: #ffffff !important;
          color: #1f2937 !important;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12) !important;
        }
        
        .toast-message {
          color: #1f2937 !important;
        }
        
        .toast-description {
          color: #6b7280 !important;
        }
        
        .toast-close {
          color: #9ca3af !important;
        }
        
        .toast-close:hover {
          color: #6b7280 !important;
          background: #f3f4f6 !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div th:replace="~{fragments/client/layout :: header}"></div>
      <div class="container">
        <div class="header-content">
          <div class="logo">
            <a th:href="@{/}">
              <div class="logo-icon">E</div>
              <span class="logo-text">EduShare</span>
            </a>
          </div>
          <nav class="main-nav">
            <a th:href="@{/}" class="nav-link">Trang chủ</a>
            <a th:href="@{/client/categories}" class="nav-link">Danh mục</a>
            <a th:href="@{/client/search(sort='newest')}" class="nav-link"
              >Tài liệu mới</a
            >
            <a th:href="@{/client/search(filter='premium')}" class="nav-link"
              >Cao cấp</a
            >
            <a th:href="@{/client/about}" class="nav-link">Giới thiệu</a>
          </nav>
          <div class="header-actions">
            <button
              class="dark-mode-toggle"
              id="darkModeToggle"
              type="button"
              aria-label="Toggle dark mode"
            >
              <span class="dark-mode-handle" id="darkModeHandle"></span>
            </button>
            <a th:href="@{/login}" class="login-btn">
              <i class="fas fa-sign-in-alt"></i> Đăng nhập
            </a>
            <a th:href="@{/register}" class="register-btn active">
              <i class="fas fa-user-plus"></i> Đăng ký
            </a>
          </div>
          <div class="mobile-menu-toggle" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
          </div>
        </div>
      </div>
      <!-- Mobile menu -->
      <div id="mobileMenu" class="mobile-menu">
        <div class="mobile-search">
          <input type="text" placeholder="Tìm kiếm tài liệu..." />
          <button>
            <i class="fas fa-search"></i>
          </button>
        </div>
        <nav class="mobile-nav">
          <a th:href="@{/}" class="mobile-nav-link">Trang chủ</a>
          <a th:href="@{/client/categories}" class="mobile-nav-link"
            >Danh mục</a
          >
          <a th:href="@{/client/search(sort='newest')}" class="mobile-nav-link"
            >Tài liệu mới</a
          >
          <a
            th:href="@{/client/search(filter='premium')}"
            class="mobile-nav-link"
            >Cao cấp</a
          >
          <a href="#" class="mobile-nav-link">Hướng dẫn</a>
        </nav>
        <div class="mobile-auth">
          <a th:href="@{/login}" class="mobile-login-btn">Đăng nhập</a>
          <a th:href="@{/register}" class="mobile-register-btn">Đăng ký</a>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main>
      <section class="auth-section">
        <div class="auth-container">
          <div class="auth-header">
            <div class="auth-header-content">
              <h1>Chia sẻ & Khám phá kiến thức</h1>
              <p>
                Cộng đồng chia sẻ tài liệu học tập hàng đầu dành cho sinh viên
                và chuyên gia Việt Nam
              </p>
            </div>
          </div>

          <div class="auth-body">
            <div class="auth-tabs">
              <button class="auth-tab active" data-tab="login">
                Đăng nhập
              </button>
              <button class="auth-tab" data-tab="register">
                <a th:href="@{/register}">Đăng ký</a>
              </button>
            </div>

            <div class="auth-forms">
              <!-- Auth Error/Success Message -->
              <div class="auth-error" th:if="${param.locked != null}" style="background: #fee; border: 1px solid #f00; padding: 10px; margin: 10px 0; border-radius: 5px; color: #d00;">
                <i class="fas fa-lock"></i>
                <span class="error-message">
                  Tài khoản đã bị khóa do đăng nhập sai quá nhiều lần. Vui lòng thử lại sau 
                  <span th:text="${param.minutes != null ? param.minutes[0] : '15'}">15</span> phút!
                </span>
              </div>
              
              <div class="auth-error" th:if="${param.error != null and param.locked == null}" style="background: #fee; border: 1px solid #f00; padding: 10px; margin: 10px 0; border-radius: 5px; color: #d00;">
                <i class="fas fa-exclamation-circle"></i>
                <span class="error-message"
                  >Thông tin đăng nhập không chính xác. Vui lòng thử lại.</span
                >
              </div>

              <div class="auth-success" th:if="${param.logout}">
                <i class="fas fa-check-circle"></i>
                <span class="success-message">Đăng xuất thành công.</span>
              </div>

              <!-- Login Form -->
              <form
                th:action="@{/login}"
                method="post"
                id="loginForm"
                class="auth-form active"
                data-form="login"
              >
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <h2 class="form-title">Chào mừng trở lại</h2>
                <p class="form-description">
                  Đăng nhập để tiếp tục hành trình học tập của bạn
                </p>

                <div class="form-group">
                  <label for="username">Tên đăng nhập</label>
                  <div class="input-group">
                    <span class="input-icon"><i class="fas fa-user"></i></span>
                    <input
                      type="text"
                      id="username"
                      name="username"
                      placeholder="Nhập tên đăng nhập"
                      required
                    />
                  </div>
                </div>

                <div class="form-group">
                  <label for="password">Mật khẩu</label>
                  <div class="input-group">
                    <span class="input-icon"><i class="fas fa-lock"></i></span>
                    <input
                      type="password"
                      id="password"
                      name="password"
                      placeholder="Nhập mật khẩu"
                      required
                    />
                    <button type="button" class="password-toggle">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </div>

                <div class="form-options">
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      id="remember-me"
                      name="remember-me"
                    />
                    <span>Ghi nhớ đăng nhập</span>
                  </label>

                  <a href="/forgot-password" class="">Quên mật khẩu?</a>
                </div>

                <button
                  type="submit"
                  class="btn btn-primary btn-block login-submit-btn"
                >
                  Đăng nhập
                </button>

                <div class="form-footer">
                  <p>
                    Chưa có tài khoản?
                    <a th:href="@{/register}">Đăng ký ngay</a>
                  </p>
                </div>
              </form>
            </div>

            <!-- Feature Cards for Mobile -->
            <div class="features-area">
              <h3 class="features-title">Tại sao chọn EduShare?</h3>

              <div class="features-grid">
                <div class="feature-card">
                  <div class="feature-card-icon">
                    <i class="fas fa-file-alt"></i>
                  </div>
                  <h4>Tài liệu chất lượng</h4>
                  <p>Hàng nghìn tài liệu học tập được kiểm duyệt chất lượng</p>
                </div>

                <div class="feature-card">
                  <div class="feature-card-icon">
                    <i class="fas fa-users"></i>
                  </div>
                  <h4>Cộng đồng học tập</h4>
                  <p>Kết nối với sinh viên và chuyên gia trong lĩnh vực</p>
                </div>

                <div class="feature-card">
                  <div class="feature-card-icon">
                    <i class="fas fa-shield-alt"></i>
                  </div>
                  <h4>Bảo mật thông tin</h4>
                  <p>Hệ thống bảo mật cao, bảo vệ thông tin cá nhân</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <div th:replace="~{fragments/client/layout :: footer}"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script th:src="@{/js/main.js}"></script>
    <script th:src="@{/js/auth.js}"></script>
    <script th:src="@{/js/client-header.js}"></script>
    <script th:src="@{/js/admin/toast.js}"></script>
    <script th:src="@{/js/admin/flash-toast.js}"></script>
  </body>
</html>
